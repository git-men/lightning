(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[29],{10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},15:function(e,t){},16:function(e,t){},17:function(e,t){},18:function(e,t){},19:function(e,t){},"1hG1":function(e,t,n){"use strict";(function(e){n("c94q");var a,r,i=n("Y/eX"),c=(n("e+1C"),n("Nd5c")),o=(n("ER8q"),n("Ai5L")),l=(n("UvA9"),n("u4G2")),s=n("tJVT"),u=n("oBTY"),d=n("9og8"),m=n("fWQN"),p=n("mtLc"),f=n("yKVA"),h=n("879j"),v=n("WmNS"),b=n.n(v),g=n("q1tI"),y=n.n(g),j=n("/MKj"),O=n("AAgL"),E=n("mmaM"),k=(a=Object(j["c"])((function(e){var t=e.content.schemas;return{schemas:t}})),a(r=function(t){Object(f["a"])(a,t);var n=Object(h["a"])(a);function a(){var e;Object(m["a"])(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e=n.call.apply(n,[this].concat(r)),e.state={remoteChoices:[]},e.myProps=["titlefield"],e.doSearch=Object(d["a"])(b.a.mark((function t(){var n,a,r;return b.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(E["cloudFunction"])({model:"auth__permission",functionName:"get_assign_permissions"});case 2:n=t.sent,a=n.result,r=a.map((function(e){return[e.id,e]})),e.setState({remoteChoices:r});case 6:case"end":return t.stop()}}),t)}))),e.permissionCheck=function(t){var n=e.props,a=n.value,r=n.onChange,i=a.map((function(e){return e.id||e})),c=t.id;i.includes(c)?r(i.filter((function(e){return e!==c}))):r([].concat(Object(u["a"])(i),[c]))},e.modelCheck=function(t){var n=e.props,a=n.value,r=n.onChange,i=a.map((function(e){return e.id||e})),c=new Set(i),o=t.filter((function(e){return!c.has(e.id)}));o.length?r([].concat(Object(u["a"])(i),Object(u["a"])(o.map((function(e){return e.id}))))):r(i.filter((function(e){return!t.map((function(e){return e.id})).includes(e)})))},e}return Object(p["a"])(a,[{key:"componentDidMount",value:function(){this.doSearch()}},{key:"titleField",get:function(){return this.props.titlefield||this.refSchema.titleField}},{key:"refSchema",get:function(){var e=this.props.schemas;return e[this.refModel]}},{key:"refModel",get:function(){var e=this.props.field;return e.ref}},{key:"render",value:function(){var t=this,n=this.props,a=n.value,r=void 0===a?[]:a,u=n.schemas,d=this.state.remoteChoices;if(!d.length)return null;var m=new Set(r.map((function(e){return e.id||e}))),p={},f={};return d.forEach((function(e){var t=Object(s["a"])(e,2),n=t[0],a=t[1],r=a.display_name,i=a.content_type,c=i.app_verbose_name,o=i.app_label,l=i.model;f[o]=c,p[o]||(p[o]={}),p[o][l]||(p[o][l]=[]),p[o][l].push({id:n,name:r,children:[]})})),y.a.createElement(i["a"],{bordered:!1,defaultActiveKey:Object.keys(p).filter((function(t){return e.flatten(e.values(p[t])).find((function(e){return m.has(e.id)}))}))},Object.entries(p).map((function(e){var n=Object(s["a"])(e,2),a=n[0],r=n[1];return y.a.createElement(i["a"].Panel,{key:a,header:f[a]},Object.entries(r).map((function(e){var n=Object(s["a"])(e,2),r=n[0],i=n[1];return y.a.createElement(c["a"],{key:"".concat(a,"__").concat(r)},y.a.createElement(o["a"],{span:5,style:{minWidth:100,height:32,overflowX:"auto",whiteSpace:"nowrap"}},y.a.createElement(l["a"],{checked:i.every((function(e){return m.has(e.id)})),onChange:function(){return t.modelCheck(i)},indeterminate:i.some((function(e){return m.has(e.id)}))&&!i.every((function(e){return m.has(e.id)}))},y.a.createElement("strong",null,(u["".concat(a,"__").concat(r)]||{}).displayName||r))),y.a.createElement(o["a"],{span:18},y.a.createElement(c["a"],{type:"flex"},i.map((function(e){return y.a.createElement(o["a"],{key:e.id,span:6,style:{minWidth:100,overflowX:"auto",overflowY:"hidden",whiteSpace:"nowrap"}},y.a.createElement(l["a"],{checked:m.has(e.id),onChange:function(){return t.permissionCheck(e)}},e.name))})))))})))})))}}]),a}(O["a"]))||r);t["a"]=k}).call(this,n("LvDl"))},20:function(e,t){},"4WK3":function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return g})),n.d(t,"d",(function(){return y})),n.d(t,"c",(function(){return j}));var a=n("0Owb"),r=n("k1fw"),i=n("jrin"),c=n("q1tI"),o=n.n(c),l=n("jfUH"),s=n("IAeB"),u=n("EBSl"),d=n("0TMk");function m(t){var n,c=t.model,s=t.onCreate,u=void 0===s?function(){}:s,m=t.onUpdate,p=void 0===m?function(){}:m,f=t.currentObject,h=void 0===f?{}:f,v=t.currentActionParams,b=void 0===v?{}:v,g=t.Id,y=t.formProps,j=void 0===y?{}:y;h&&(n=g||Object(l["M"])(h,c));var O=b.isCopy,E=b.editFields,k=b.fields,w=void 0===k?[]:k,_={};O&&(_.isCopy=!0),e.isEmpty(w)||(_.hiddenvalues=w.reduce((function(e,t){var n=e;return n[t.name]=t.value,n}),{}),_.partialupdate=!0),E&&(_.fields=E,_.partialupdate=!0);var x=c,C=n,S=h;if(b.field){var F=Object(l["r"])(c,b.field,h),A=F.id,P=F.schemaField,M=F.value;if(x=P.ref,"refAdd"===b.action){var N="bref"===P.type?n:[n],D=Object(i["a"])({},P.refField,N);b.values&&(D=Object(r["a"])(Object(r["a"])({},D),b.values)),_.hiddenvalues=D,_.hiddenFields=_.hiddenvalues,C=void 0,S=void 0}else C=A,S=M}return b.model&&(x=b.model),o.a.createElement(d["a"],Object(a["a"])({model:x,objectid:C,currentObject:S,onCreate:u,onUpdate:p},j,_))}function p(e){var t=e.model,n=e.currentObject,a=e.currentActionParams,r=t,i=Object(l["M"])(n,t),c=a.field,u=a.page;if(c){var d=Object(l["r"])(t,c,n),m=d.id,p=d.schemaField;r=p.ref,i=m}return o.a.createElement(s["a"],{model:r,page:u,id:i,custom:!0})}function f(e){var t=e.model,n=e.currentActionObject,a=e.currentObject,r=e.currentActionParams,i=e.context,c=n.callback;return m({model:t,currentObject:a,currentActionParams:r,onUpdate:function(){return c(i)},onCreate:function(){return c(i)},formProps:i.formProps})}function h(e){var t=e.model,n=e.currentObject,a=e.currentActionParams,r=e.Schemas,i=void 0===r?[]:r,c=i[t]||{};if(a.field){var o=Object(l["t"])(t,a.field);return"\u7f16\u8f91".concat(o.displayName)}return"".concat(n[c.titleField]?"\u3010".concat(n[c.titleField],"\u3011- "):"","\u7f16\u8f91").concat(c.displayName)}function v(e){var t=e.model,n=e.currentObject,a=e.currentActionParams;return p({model:t,currentObject:n,currentActionParams:a})}function b(e){var t=e.model,n=e.currentActionParams,a=e.Schemas,r=void 0===a?[]:a,i=r[t]||{};if(n.field){var c=Object(l["t"])(t,n.field);return"".concat(c.displayName,"\u8be6\u60c5")}return"".concat(i.displayName,"\u8be6\u60c5")}function g(e){var t=e.model,n=e.currentActionParams,a=e.Schemas,r=void 0===a?[]:a,i=r[t]||{};if(n.field){var c=Object(l["t"])(t,n.field);return"\u65b0\u5efa".concat(c.displayName)}return n.model?"\u65b0\u5efa".concat(r[n.model].displayName):"\u65b0\u5efa".concat(i.displayName)}function y(e){var t=e.refresh;t()}function j(){Object(u["q"])({type:u["c"],action:"edit",name:"\u7f16\u8f91",rspType:u["j"],title:h,component:f,callback:y}),Object(u["q"])({type:u["c"],action:"partEdit",name:"\u90e8\u4efd\u7f16\u8f91",rspType:u["j"],title:h,component:f,callback:y}),Object(u["q"])({type:u["c"],action:"refEdit",name:"\u5173\u8054\u7f16\u8f91",rspType:u["j"],title:h,component:f,callback:y}),Object(u["q"])({type:u["c"],action:"detail",name:"\u8be6\u60c5",rspType:u["j"],title:b,component:v}),Object(u["q"])({type:u["c"],action:"refDetail",name:"\u5173\u8054\u8be6\u60c5",rspType:u["j"],title:b,component:v}),Object(u["q"])({type:u["c"],action:"copy",name:"\u590d\u5236",rspType:u["j"],title:g,component:f,callback:y}),Object(u["q"])({type:u["c"],action:"refAdd",name:"\u5173\u8054\u521b\u5efa",rspType:u["j"],title:g,component:f,callback:y})}}).call(this,n("LvDl"))},"9uep":function(e,t,n){"use strict";var a=n("Utjr");t["a"]=Object(a["d"])((function(){return Promise.all([n.e(3),n.e(2),n.e(4),n.e(22)]).then(n.bind(null,"yPhJ"))}))},"ASN+":function(e,t,n){"use strict";n.d(t,"b",(function(){return x}));n("eNCU");var a=n("pjJH"),r=(n("GPKB"),n("mFAc")),i=(n("WlnS"),n("7sSx")),c=(n("ascH"),n("GqlH")),o=(n("4X2C"),n("xvon")),l=n("tJVT"),s=n("q1tI"),u=n.n(s),d=n("ZlLr"),m=n.n(d),p=n("R1kb"),f=n.n(p),h=n("wd/R"),v=n.n(h),b=n("mmaM"),g=n("jfUH"),y=n("Z3Sq"),j=n.n(y);function O(e){return e&&e.replace(/\s/g,"")}function E(e){return Uint8Array.from(e,(function(e){return e.charCodeAt(0)}))}var k="MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAxR4BICJ+rc5vLVzMk5Z8AZTIbu26eclr6c/a6+5OphlZg16RRMc3ySZ5idB27Sr7Nj4ootV6F0nfBibqXBbQKOoAACF7EO7Js8p7cZFKv5QnDrAIbBbksFYSRGDE7A0E3PjYXht7BTNIUdvOzWlBMNMK3YdQsComvB8pOS14OZ6EUEgk4DNSB0GJUGZPJ9w5Wf2CY5eNgGHFjdI8rv9lIQqU2VDOkTVtyRlcrDbfBi68hoAm6zzLyUQEGEBkZybcCJW6yzXjrc/ade3NRIg81ZgG7Uo8hBsZSTHf3Y2T3y7Uto8KY+jini09/pRvwCqERiImZI+72ByhvBvgXUndyqhXo7CGP1lvYtwt9XjAf4gAe9Y2GZJGAoV8q4w2c4wsWEkijwSuTCOo1LtvprFyN9GQDI72NDpoxVGl4O6MKcMXGsO5Zb7NzYmnlteCf0Ug//gFbehPAIPPzpInKwn8yGA/gWaO8sjGC5vy3hhq5sofE9hhzxwNliZymkzourDTAgMBAAE=",w=new m.a.Key("der",E(window.atob(k))),_=w.jwk,x={},C=function(){var e=Object(s["useState"])(),t=Object(l["a"])(e,2),n=t[0],a=t[1],r=Object(s["useState"])(!1),i=Object(l["a"])(r,2),c=i[0],o=i[1];return Object(s["useEffect"])((function(){Object(b["cloudFunc"])({model:"bsm_config__setting",functionName:"get_code",params:{}}).then(a).catch((function(){return o(!0)}))}),[]),[n,c]};t["a"]=function(e){var t=e.value,n=e.onChange,d=C(),m=Object(l["a"])(d,2),p=m[0],h=m[1],y=Object(s["useState"])(),k=Object(l["a"])(y,2),w=k[0],S=k[1],F=Object(s["useState"])(null),A=Object(l["a"])(F,2),P=A[0],M=A[1],N=null!==P;Object(s["useEffect"])((function(){_.then(S)}),[]),Object(s["useEffect"])((function(){if(t&&p&&w){var e=O(t);e+="=".repeat((-e.length%4+4)%4);try{var n=window.atob(e.replace(/</g,"+").replace(/>/g,"/")).split("\n"),a=n[0],r=n.slice(1).join("\n");f.a.verify(E(p+a),E(r),w,"SHA-1",{name:"RSA-PSS",saltLength:20}).then(M).catch((function(){return Object(b["cloudFunc"])({model:"bsm_config__setting",functionName:"verify",params:{license:O(t)}}).then((function(e){var t=e.valid;return M(t)}))}))}catch(i){M(!1)}}else M(null)}),[w,t,p]),Object(s["useEffect"])((function(){N?x.valid=P:delete x.valid}));var D="License \u6b63\u786e";if(P&&t&&p&&w){var T=O(t);T+="=".repeat((-T.length%4+4)%4);try{var I=window.atob(T.replace(/</g,"+").replace(/>/g,"/")).split("\n"),L=I[0],q=JSON.parse(L);D={free:"\u514d\u8d39",standard:"\u6807\u51c6",pro:"\u4e13\u4e1a"}[q.type],D+="".concat(q.trial?"\u8bd5\u7528":"","\u7248\uff0c\u6388\u6743\u4e88"),D+=q.purchaser,q.trial&&(D+="\uff0c".concat(v.a.unix(q.register_time).add(q.trial_days,"days").format("YYYY-MM-DD HH:mm:ss")," \u5230\u671f"))}catch(B){}}return u.a.createElement(u.a.Fragment,null,u.a.createElement(o["a"].TextArea,{className:N&&(P?j.a.success:j.a.error),allowClear:!0,value:O(t),onChange:function(e){return n(O(e.target.value))},autosize:{minRows:5},disabled:h}),N&&(P?u.a.createElement(c["a"],{message:D,type:"success",showIcon:!0}):u.a.createElement(c["a"],{message:"License \u65e0\u6548",type:"error",showIcon:!0})),p&&u.a.createElement(u.a.Fragment,null,"\u60a8\u7684\u5e8f\u5217\u53f7\uff1a",u.a.createElement(i["a"],null,p),u.a.createElement(a["a"],{size:"small",onClick:function(){Object(g["f"])(p),r["a"].success("\u5e8f\u5217\u53f7 ".concat(p," \u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"))}},"\u590d\u5236")),h&&u.a.createElement("span",{style:{color:"red"}},"\u65e0\u6cd5\u83b7\u53d6\u5e8f\u5217\u53f7"))}},C2ml:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var a=n("q1tI"),r=n.n(a),i=n("ZFw/"),c=n.n(i),o=n("jfUH"),l=function(t){var n=t.children,a=Object(o["yb"])("title"),i=e.isArray(n)?n.join(""):n,l=a&&i?" - ":"",s=a?i+l+a:i;return r.a.createElement(c.a,{title:s})}}).call(this,n("LvDl"))},CD42:function(e,t,n){e.exports={container:"container___3pl9V",content:"content___3e9Ph",content_box:"content_box___Uidox",select:"select___3x4xw"}},Cnxa:function(e,t,n){"use strict";(function(e){n("e+1C");var a=n("Nd5c"),r=(n("ER8q"),n("Ai5L")),i=(n("eNCU"),n("pjJH")),c=n("9og8"),o=n("fWQN"),l=n("mtLc"),s=n("yKVA"),u=n("879j"),d=(n("yavW"),n("WuMn")),m=(n("vmZS"),n("NjVP")),p=n("WmNS"),f=n.n(p),h=n("q1tI"),v=n.n(h),b=n("mmaM"),g=m["a"].Item,y=d["a"].Option,j={},O=function(t){Object(s["a"])(p,t);var n=Object(u["a"])(p);function p(){var e;return Object(o["a"])(this,p),e=n.call(this),e.onFieldsChange=function(){var t=Object(c["a"])(f.a.mark((function t(n,a,r){var i,c,o;return f.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=e.props.form,c=i.getFieldValue("through_field_1"),o=i.getFieldValue("through_field_2"),c===o&&r("\u8bf7\u9009\u62e9\u4e0d\u540c\u7684\u5916\u952e"),r();case 5:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),e.submit=Object(c["a"])(f.a.mark((function t(){var n,a,r,i,c;return f.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.props,a=n.form,r=n.record,i=n.closeModal,e.setState({loading:!0}),c=a.getFieldsValue(),c.model_id=r.id,t.prev=4,t.next=7,Object(b["setIntermediaryTable"])(c);case 7:e.setState({loading:!1}),i(),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),console.error(t.t0);case 14:case"end":return t.stop()}}),t,null,[[4,11]])}))),e.check=function(){var t=e.props.form;t.validateFields((function(t){t||e.submit()}))},e.state={fkFields:[],loading:!1},e}return Object(l["a"])(p,[{key:"componentDidMount",value:function(){var e=Object(c["a"])(f.a.mark((function e(){var t,n,a,r;return f.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props.record,this.setState({loading:!0}),e.next=4,Object(b["queryContent"])({model:"meta__field",filters:[{field:"model",value:t.id,operator:"="}]},1,1e3);case 4:n=e.sent,a=n.list,this.setState({loading:!1}),r=a.filter((function(e){return"fk"===e.type})),this.setState({fkFields:r});case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"renderForm",value:function(){var t=this.props,n=t.form,c=n.getFieldDecorator,o=n.getFieldValue,l=n.resetFields,s=n.getFieldsValue,u=t.closeModal,p=this.state,f=p.fkFields,h=p.loading,b=function(e){return f.map((function(t){return v.a.createElement(y,{disabled:e===t.name,key:t.name},t.verbose_name||t.name||t.db_column)}))};return v.a.createElement("div",null,v.a.createElement(m["a"],j,v.a.createElement(g,{label:"\u4e3b\u8868\u5916\u952e"},c("through_field_1",{rules:[{required:!0,message:"\u4e3b\u8868\u5916\u952e\u662f\u5fc5\u586b\u7684"}]})(v.a.createElement(d["a"],{allowClear:!0},b(o("through_field_2"))))),v.a.createElement(g,{label:"\u6b21\u8868\u5916\u952e"},c("through_field_2",{rules:[{required:!0,message:"\u6b21\u8868\u5916\u952e\u662f\u5fc5\u586b\u7684"},{validator:this.onFieldsChange}]})(v.a.createElement(d["a"],{allowClear:!0},b(o("through_field_1"))))),v.a.createElement(g,null,v.a.createElement(a["a"],null,v.a.createElement(r["a"],null,v.a.createElement(i["a"],{type:"primary",onClick:this.check,style:{marginRight:16},disabled:h},"\u4fdd\u5b58"),v.a.createElement(i["a"],{type:"default",onClick:function(){u()}},"\u53d6\u6d88"),e.values(s()).some(Boolean)&&v.a.createElement(i["a"],{style:{marginLeft:16},onClick:function(){return l()}},"\u91cd\u8bbe"))))))}},{key:"render",value:function(){var e=this.props.record;return!e.fk_field_count||e.fk_field_count<2?v.a.createElement("p",null,"\u4e0d\u652f\u6301\u5c06\u8be5\u8868\u8bbe\u7f6e\u4e3a\u4e2d\u95f4\u8868"):this.renderForm()}}]),p}(h["PureComponent"]),E=m["a"].create({})(O);t["a"]=E}).call(this,n("LvDl"))},IAeB:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return V}));n("52nx");var a,r,i,c,o,l,s=n("7bDm"),u=n("0Owb"),d=n("tJVT"),m=(n("GPKB"),n("mFAc")),p=n("9og8"),f=n("fWQN"),h=n("mtLc"),v=n("tS8v"),b=n("yKVA"),g=n("879j"),y=(n("SePM"),n("PMX6")),j=(n("vifT"),n("nODz")),O=n("WmNS"),E=n.n(O),k=n("q1tI"),w=n.n(k),_=n("WHYC"),x=n("RLxJ"),C=n("/MKj"),S=n("Hx5s"),F=n("UmlX"),A=n("leA8"),P=n("sC82"),M=n("jfUH"),N=n("BE/h"),D=n("flKx"),T=n("3i6F"),I=n("C2ml"),L=n("y/44"),q=n("G3ML"),B=P["a"].Description,U=w.a.createElement(y["a"],{style:{width:"100%"}},w.a.createElement(j["a"],{image:j["a"].PRESENTED_IMAGE_SIMPLE})),V=(a=Object(C["c"])((function(e){var t=e.content,n=t.schemas,a=t.adminConfig,r=t.data,i=e.loading,c=e.user.currentUser,o=e.bsmSetting;return{schemas:n,adminConfig:a,data:r,loading:i.models.content,currentUser:c,bsmSetting:o}})),r=Reflect.metadata("design:type",Function),i=Reflect.metadata("design:paramtypes",[void 0]),Object(_["k"])(c=a(c=r(c=i((l=o=function(t){Object(b["a"])(a,t);var n=Object(g["a"])(a);function a(t){var r;return Object(f["a"])(this,a),r=n.call(this,t),r.getDetailList=function(){var t=r.getProps,n=t.model,a=t.adminConfig,i=a[n]||{},c=i.detailLayout,o=void 0===c?{}:c,l=i.details,s=void 0===l?[]:l,u=[],d=s;return o.tabs?o.tabs.forEach((function(e){var t=d.find((function(t){return t.key===e}));t&&u.push({tab:t.title,key:t.key})})):e.isEmpty(d)||d.forEach((function(e,t){u.push({tab:e.title||"\u8be6\u60c5".concat(t?t+1:""),key:e.key})})),{detailList:d,tabList:u}},r.init=Object(p["a"])(E.a.mark((function e(){return E.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.getDetail();case 1:case"end":return e.stop()}}),e)}))),r.getInlineActions=function(){var e=r.getProps,t=e.adminConfig,n=void 0===t?{}:t,a=e.model,i=n[a],c=i.inlineActions,o=i.maxInlineActions,l=i.modalForm,s=i.modalDetail;return w.a.createElement(q["a"],{type:"button",popPlacement:"bottomRight",modalForm:l,modalDetail:s,maxItem:o,model:a,onClick:r.handleInlineAction,record:r.detailObject,items:c.filter((function(e){return![e.type,e.action].includes("detail")}))})},r.handleInlineAction=function(){var e=Object(p["a"])(E.a.mark((function e(t,n,a){var i;return E.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return"action"===t.type&&(i=m["a"].loading({content:"".concat(t.title,"\u6267\u884c\u4e2d"),key:t.title,duration:0})),e.prev=1,e.next=4,a(t,n,{refresh:function(){var e=Object(p["a"])(E.a.mark((function e(){return E.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.getDetail({msgOption:!1});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),404===e.t0.error_code&&(m["a"].info("\u6570\u636e\u5df2\u5220\u9664"),x["a"].push("/content/".concat(t.params.payload.model)));case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));function n(){return e.apply(this,arguments)}return n}(),showModal:r.handleShowModal.bind(Object(v["a"])(r)),showDrawer:r.handlerShowDrawer.bind(Object(v["a"])(r)),link:function(e,t,n){return Object(M["Q"])(n.link,(function(t){return e[t]}))},collectInputs:r.collectInputs.bind(Object(v["a"])(r)),hideCollectInput:r.hideCollectInput.bind(Object(v["a"])(r))});case 4:e.next=8;break;case 6:e.prev=6,e.t0=e["catch"](1);case 8:return e.prev=8,i&&i(),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[1,6,8,11]])})));return function(t,n,a){return e.apply(this,arguments)}}(),r.handleOk=function(){r.setState({showModal:!1})},r.handleCancel=function(){r.setState({showModal:!1})},r.handleShowModal=function(e,t,n){r.setState({currentObject:e,currentActionObject:t,currentActionParams:n,showModal:!0})},r.handlerShowDrawer=function(e,t,n){r.setState({currentObject:e,currentActionObject:t,currentActionParams:n,showDrawer:!0})},r.getDescription=function(){var t,n=r.getProps,a=n.adminConfig,i=n.model,c=a[i].detailLayout,o=void 0===c?{headerFields:[]}:c;if(e.isEmpty(r.detailObject))return null;var l=null===(t=o.headerFields||[])||void 0===t?void 0:t.map((function(e){var t,n;return[null!==(t=null===(n=Object(M["t"])(i,e))||void 0===n?void 0:n.displayName)&&void 0!==t?t:e,Object(M["k"])(e,r.detailObject)]}));return w.a.createElement(P["a"],{style:{marginBottom:4},size:"small",col:"2"},l.map((function(e){var t=Object(d["a"])(e,2),n=t[0],a=t[1];return w.a.createElement(B,{term:n},a)})))},r.state={showModal:!1,showDrawer:!1,currentObject:{},currentActionObject:{},currentActionParams:{},plainFormVisible:!1,plainFormFields:[],plainFormSubmit:void 0,plainFormCancel:void 0,tabActiveKey:t.page},r}return Object(h["a"])(a,[{key:"componentDidMount",value:function(){var t=this.getProps,n=t.schemas,a=t.adminConfig;e.isEmpty(n)||e.isEmpty(a)||this.init();var r=document.querySelector(".ant-layout.ant-layout-has-sider > .ant-layout");r&&(r.style.overflowX="unset"),document.body.scrollTop=0,document.documentElement.scrollTop=0}},{key:"componentDidUpdate",value:function(t,n){var a=function(t){var n=t.schemas,a=t.adminConfig;return!e.isEmpty(n)&&!e.isEmpty(a)},r=a(t),i=a(this.getProps),c=t.match.params.id,o=t.id,l=o||c;(!r&&i||l&&l!==this.getProps.id||n.tabActiveKey!==this.state.tabActiveKey)&&this.init()}},{key:"componentWillUnmount",value:function(){var e=document.querySelector(".ant-layout.ant-layout-has-sider > .ant-layout");e&&(e.style.overflowX=null)}},{key:"detailObject",get:function(){var e,t,n=this.getProps,a=n.model,r=n.data,i=void 0===r?{}:r,c=n.id,o=(null===(e=i[a])||void 0===e?void 0:e.detail)||{};return null!==(t=o[c])&&void 0!==t?t:o}},{key:"getProps",get:function(){var e=this.props,t=e.data,n=e.schemas,a=e.adminConfig,r=e.dispatch,i=e.match,c=i.path,o=i.url,l=e.groupList,s=e.groupCount,u=e.id,d=e.model,m=e.custom,p=e.bsmSetting,f=e.currentUser;return{data:t,schemas:n,adminConfig:a,model:d,id:u,dispatch:r,url:o,path:c,groupList:l,groupCount:s,custom:m,bsmSetting:p,currentUser:f}}},{key:"getDetail",value:function(e){var t=this.getProps,n=t.dispatch,a=t.model,r=t.id,i=t.adminConfig,c=i[a]&&(i[a].detail||i[a].details);if("__index__"!==r&&c){var o,l=this.getDetailList(),s=l.detailList,u=void 0===s?[]:s,d=this.state.tabActiveKey,m=void 0===d?null===(o=u[0])||void 0===o?void 0:o.key:d,p=u.find((function(e){return e.key===m}));return n({type:"content/detail",payload:{model:a,id:r,fieldsType:"detailFields",wrapOptions:e,detail:p}}).then((function(){}))}return null}},{key:"collectInputs",value:function(e,t,n){this.setState({plainFormVisible:!0,plainFormFields:e,plainFormSubmit:t,plainFormCancel:n})}},{key:"hideCollectInput",value:function(){this.setState({plainFormVisible:!1,plainFormFields:[],plainFormSubmit:void 0,plainFormCancel:void 0})}},{key:"render",value:function(){var t,n,a=this,r=this.getProps,i=r.model,c=r.id,o=r.adminConfig,l=r.schemas,d=r.data,m=r.custom,p=r.currentUser;if(e.isEmpty(o)||e.isEmpty(p))return null;var f=this.state,h=f.showModal,v=f.showDrawer,b=f.currentActionObject,g=f.currentActionParams,y=f.currentObject,j=l[i]||{},O=e.get(d,"".concat(i,".detail.").concat(c),""),E=O[j.titleField]||"".concat(j.displayName,"\u8be6\u60c5"),_=o[i]||{},C=_.detail,P=_.detailLayout,q=void 0===P?{}:P,B=this.getDetailList(),V=B.tabList,K=B.detailList,R=this.state,W=R.plainFormVisible,Y=R.plainFormFields,z=R.plainFormCancel,G=R.plainFormSubmit,H=R.tabActiveKey,J=void 0===H?null===(t=K[0])||void 0===t?void 0:t.key:H,X=w.a.createElement(k["Fragment"],null,w.a.createElement(N["a"],{visible:h,handleOk:this.handleOk,handleCancel:this.handleCancel,currentActionObject:b,currentObject:y,currentActionParams:g,model:i,context:{refresh:function(){a.getDetail(),a.handleCancel()},close:function(){a.handleCancel()}}}),w.a.createElement(D["a"],{currentActionObject:b,currentObject:y,currentActionParams:g,visible:v,model:i,context:{hideDrawer:function(){a.setState({showDrawer:!1})}}})),Z=K.find((function(e){return e.key===J}))||C,Q=Z?w.a.createElement("div",{style:{width:0,flex:1}},w.a.createElement(F["a"],{model:i,id:c,detail:Z,key:J})):U;if((!o[i]||!C)&&!o[i].details)return null;var $=C,ee=$||{},te=ee.showNav,ne=w.a.createElement("div",{style:{display:"flex"}},te&&w.a.createElement(A["a"],null),"__index__"!==c?Q:U);if(m)return ne;var ae=J&&(null===(n=V.find((function(e){return e.key===J})))||void 0===n?void 0:n.tab);return w.a.createElement(S["a"],{title:E,tabActiveKey:J,tabList:V,extra:this.getInlineActions(),onTabChange:function(e){return a.setState({tabActiveKey:e})},content:this.getDescription(),onBack:x["a"].goBack,avatar:q.avatar&&{src:Object(M["v"])(O[q.avatar],{height:40,width:40})},tags:e(q.tags||{}).map((function(e,t){return w.a.createElement(T["c"],Object(u["a"])({value:O[t],field:j.fields.find((function(e){return e.name===t}))},e))})).value()},w.a.createElement(I["a"],null,E,ae&&" - ".concat(ae)||""),X,ne,w.a.createElement(s["a"],{title:"\u8bf7\u8f93\u5165\u53c2\u6570",width:"60%",footer:null,visible:W,onCancel:function(){return a.setState({plainFormVisible:!1})}},w.a.createElement(L["a"],{fields:Y,onSubmit:G,onCancel:z})))}}]),a}(k["Component"]),o.defaultProps={groupList:!1,groupCount:20},c=l))||c)||c)||c)||c);t["b"]=Object(_["k"])((function(e){var t=e.match.params,n=t.model,a=t.id,r=e.location.query.page;return w.a.createElement(V,{key:"".concat(n,"-").concat(a),page:r,id:a,model:n})}))}).call(this,n("LvDl"))},Lafb:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var a=n("jrin"),r=n("VoC+"),i=n("9Ndd"),c=n("jfUH");function o(t,n,o,l,s){var u=l.watchFields,d=l.parameters,m=d.targetField,p=d.mapping,f=s.model,h=s.schemas,v=s.adminConfig,b=h[f],g=b.fields.filter((function(e){return-1!==u.indexOf(e.name)&&"mref"===e.type})),y=b.fields.find((function(e){return e.name===m&&"bref"===e.type}));if(g&&y&&g.length===u.length){var j=u.map((function(e){return e===n?o:t.getFieldsValue([e])[e]})),O=j.filter((function(e){return void 0!==e}));if(!(O.length<=1)){var E=Object(r["a"])(j),k=[],w=h[y.ref];E.forEach((function(e){var t=Object(i["c"])(w,v[y.ref].formFields);u.forEach((function(n,a){var r=p[n];t[r]=e[a]})),k.push(t)}));var _=t.getFieldsValue([m])[m];if(k.length>0){var x=[];if(_&&_.length>0){var C=e.values(p);k.forEach((function(e){var t=!1,n=C.map((function(t){return e[t][Object(c["N"])(w.fields.find((function(e){return e.name===t})).ref)]})).join("_");_.every((function(e){var a=C.map((function(t){return e[t][Object(c["N"])(w.fields.find((function(e){return e.name===t})).ref)]})).join("_");return n!==a||(t=!0,x.push(e),!1)})),t||x.push(e)})),t.setFieldsValue(Object(a["a"])({},m,x))}else t.setFieldsValue(Object(a["a"])({},m,k))}else _&&_.length>0&&t.setFieldsValue(Object(a["a"])({},m,[]))}}}}).call(this,n("LvDl"))},UmlX:function(e,t,n){"use strict";(function(e){n("5RCp");var a,r,i,c,o=n("a82I"),l=(n("Ahcs"),n("k0dM")),s=(n("SePM"),n("PMX6")),u=(n("e+1C"),n("Nd5c")),d=(n("ER8q"),n("Ai5L")),m=n("0Owb"),p=(n("/pxP"),n("oqP9")),f=n("k1fw"),h=n("fWQN"),v=n("mtLc"),b=n("yKVA"),g=n("879j"),y=n("q1tI"),j=n.n(y),O=n("/MKj"),E=n("3i6F"),k=n("OFLC"),w=n("jfUH"),_=n("mmaM"),x=n("rQ+i"),C=n("wiuW"),S=n("Utjr");function F(e,t,n){if(t in C["f"]&&C["f"][t].includes(n)){var a=C["d"][t];return j.a.createElement(a,{model:n,detailObject:e})}return null}var A={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20},md:{span:19}}},P=(a=e.flow(Object(O["c"])((function(e){var t=e.content,n=t.data,a=t.adminConfig,r=t.schemas,i=e.bsmSetting,c=e.loading,o=e.user.currentUser;return{data:n,adminConfig:a,schemas:r,loading:c.models.content,bsmSetting:i,currentUser:o}})),Object(w["d"])((function(e){var t=e.model;return{getDisplayWidgetName:Object(E["l"])(t),onMobile:Object(w["mb"])()}}))),a((c=i=function(t){Object(b["a"])(a,t);var n=Object(g["a"])(a);function a(){var e;Object(h["a"])(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e=n.call.apply(n,[this].concat(r)),e.state={previewImageUrl:void 0,previewImageVisible:!1},e.setPreviewImageVisible=function(t){e.setState({previewImageVisible:t})},e.changePreviewImageUrl=function(t){e.setState({previewImageUrl:t})},e}return Object(v["a"])(a,[{key:"model",get:function(){var e=this.props.model;return e}},{key:"schema",get:function(){return this.schemas[this.model]}},{key:"admin",get:function(){return this.admins[this.model]}},{key:"schemas",get:function(){var e=this.props.schemas;return e}},{key:"admins",get:function(){var e=this.props.adminConfig;return e}},{key:"detail",get:function(){var e=this.props,t=e.model,n=e.detail,a=void 0===n?{}:n,r=Object(w["p"])(t);if(a.fields)return Object(f["a"])(Object(f["a"])({},a),{},{fields:a.fields.filter((function(e){var t,n;return null===(t=null===(n=r[e.name||e])||void 0===n?void 0:n.read)||void 0===t||t}))});var i=Object(f["a"])({},a);return a.sections&&a.sections.forEach((function(e,t){i.sections[t].fields=e.fields.filter((function(e){var t,n;return null===(t=null===(n=r[e.name||e])||void 0===n?void 0:n.read)||void 0===t||t}))})),i}},{key:"nullOrDetailObject",get:function(){var e=this.props,t=e.data,n=e.id,a=t[this.model].detail;return null===a||void 0===a?void 0:a[n]}},{key:"detailObject",get:function(){var e,t,n=this.props,a=n.data,r=n.id,i=null===(e=a[this.model])||void 0===e?void 0:e.detail;return null!==(t=null===i||void 0===i?void 0:i[r])&&void 0!==t?t:i}},{key:"relativeFormContext",get:function(){var e=this,t={};return this.schema.fields.forEach((function(n){"bref"!==n.type||n.refField in t||(t[n.refField]=e.detailObject)})),t}},{key:"getExpandFields",value:function(){var e=this.props,t=e.model,n=e._getExpandFields,a=void 0===n?_["getExpandFields"]:n;return a(t)}},{key:"canRender",value:function(){var t=this.props.data,n=this.model,a=this.schemas,r=this.admin;return!(e.isEmpty(a)||e.isEmpty(r)||e.isEmpty(t)||e.isEmpty(t[n])||e.isEmpty(t[n].detail))}},{key:"renderField",value:function(e,t,n){var a,r,i=this.props.getDisplayWidgetName,c=this.model,o=this.schemas,l=this.changePreviewImageUrl,s=this.setPreviewImageVisible,h=this.admins,v=e.name,b=Object(w["j"])(c,v,o),g=h[this.model].display,y=g.find((function(e){return e.name===v})),O=e.widget,k=void 0===O?null===y||void 0===y?void 0:y.widget:O,_=e.params,x=void 0===_?null===y||void 0===y?void 0:y.params:_,C={};k||(k=i(e));var S=["multi-image","longtext"];S.includes(k)&&(null!==(a=this.detail)&&void 0!==a&&a.fields||"cell"===(null===n||void 0===n||null===(r=n.style)||void 0===r?void 0:r.widget))&&(C.isExpand=!0);var F=this.detailObject,P=Object(f["a"])(Object(f["a"])({},x),{},{field:b,model:v.includes(".")?Object(w["j"])(c,e.name.split(".").slice(0,-1).join("."),o).ref:c,Schemas:o,changePreviewImageUrl:l,setPreviewImageVisible:s,Admins:h,displayFields:y?[y]:[],fields:[b],displayField:e,instance:F},C);"bref"!==(null===b||void 0===b?void 0:b.type)||null!==v&&void 0!==v&&v.includes(".")||(k="table");var M=function(){return j.a.createElement(E["a"],{fields:{value:v},model:c,widgetName:k,record:F,widgetProps:P})},N=e.alias||(null===y||void 0===y?void 0:y.alias)||Object(w["l"])(o,v,c).map((function(e){return e.displayName})).join(""),D=function(){var e,n=M();if("table"===k)return n;switch(t){case"description":e=j.a.createElement(p["a"].Item,{label:N,key:b.name},n);break;default:e=j.a.createElement(u["a"],{key:b.name,style:{padding:"10px 10px"}},j.a.createElement(d["a"],Object(m["a"])({style:{fontWeight:"bold"}},A.labelCol),"".concat(N," :")),j.a.createElement(d["a"],A.wrapperCol,n));break}return e};return F&&D()}},{key:"renderSection",value:function(e){var t=this,n=e.title,a=void 0===n?"":n,r=e.fields,i=void 0===r?[]:r,c=e.description,u=e.style,d=void 0===u?"group":u,m=e.index,h=e.sectionStyle,v=void 0===h?{}:h,b=e.model,g=y["Fragment"],O={key:m};switch(d){case"group":g=s["a"],O=Object(f["a"])(Object(f["a"])({},O),{},{bordered:!1,title:a,style:{marginBottom:24},loading:!this.nullOrDetailObject});break;case"tab":g=l["a"].TabPane,O=Object(f["a"])(Object(f["a"])({},O),{},{tab:a});break;default:g=o["a"].Step,O=Object(f["a"])(Object(f["a"])({},O),{},{title:a,description:c});break}var E=v.widget,k=v.params,w=y["Fragment"],_={},x="";switch(E){case"descriptions":case"table":case"table-v":case"tiles":switch(w=p["a"],_=Object(f["a"])({column:{xs:1,sm:2,md:3,xl:4,xxl:6}},k),E){case"table-v":_.layout="vertical";case"table":_.bordered=!0;break;default:break}x="description";break;default:break}var C=function(e){return e.map((function(e){return t.renderField(e,x,v)}))};return j.a.createElement(g,O,j.a.createElement(w,_,C(i.filter((function(e){return"bref"!==e.type})))),F(this.detailObject,E,b),C(i.filter((function(e){return"bref"===e.type}))))}},{key:"renderDetail",value:function(t){var n=this,a=t.sections,r=t.style,i=t.fields,c=this.model,u=this.props.currentUser,d=function(t){return t.map((function(t){return e.isString(t)?{name:t}:t})).filter((function(e){var t=e.name;return Object(w["t"])(c,t)})).filter((function(e){var t=e.showIf;return!(t&&!Object(w["H"])(t,n.detailObject,n.schemas,n.model))})).filter((function(e){var t={fields:e,currentUser:u,model:c},n=Object(x["c"])(t);return n}))};if(a&&a.length){var m=y["Fragment"];"tab"===r?m=l["a"]:"step"===r&&(m=o["a"]);var p=j.a.createElement(m,null,a.map((function(t,a){var i,o=d(t.fields);return((null===t||void 0===t||null===(i=t.style)||void 0===i?void 0:i.widget)in C["d"]||!e.isEmpty(o))&&n.renderSection({title:t.title,fields:o,description:t.description,style:r,index:a,sectionStyle:t.style,model:c})})));return j.a.createElement(y["Fragment"],null,"group"===r?p:j.a.createElement(s["a"],{loading:!this.nullOrDetailObject,bordered:!1},p))}var f=d(i);return j.a.createElement(y["Fragment"],null,f.map((function(e){return n.renderField(e)})))}},{key:"render",value:function(){var e=this;if(!this.canRender()||!this.detailObject)return null;var t=this.state,n=t.previewImageUrl,a=t.previewImageVisible,r=j.a.createElement(k["a"],{url:n,visible:a,onClose:function(){return e.setState({previewImageVisible:!1})}}),i=this.props.onMobile;return j.a.createElement(S["c"].Provider,{value:this.relativeFormContext},r,j.a.createElement("div",{style:i?{marginLeft:-24,marginRight:-24}:{}},this.renderDetail(this.detail)))}}]),a}(y["Component"]),i.defaultProps={},r=c))||r);t["a"]=P}).call(this,n("LvDl"))},"VoC+":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("oBTY");function r(e){if(1===e.length)return e[0].map((function(e){return[e]}));var t=[],n=e[0],i=e[1];if(n.forEach((function(e){i.forEach((function(n){t.push([e,n])}))})),e.length>2){var c=e.splice(0,2),o=[t].concat(Object(a["a"])(c));t=r(o)}return t}},Z3Sq:function(e,t,n){e.exports={success:"success___1ltB-",error:"error___bK3jg"}},beBC:function(e,t,n){"use strict";n.r(t);var a,r=n("q1tI"),i=n.n(r),c=(n("F4L/"),n("iTJz")),o=(n("GNNt"),n("wEI+")),l=n("SA0R"),s=n.n(l),u=(n("yavW"),n("WuMn")),d=n("9Ndd"),m=n("2mwZ"),p=n("ASN+"),f=n("d76M"),h=(n("52nx"),n("7bDm")),v=n("jrin"),b="int",g="char",y="text",j="bool",O="fk",E="m2m",k="o2o",w="decimal",_="date",x="datetime",C="time",S="email",F="auto",A="float",P="ipaddr",M="positiveint",N="slug",D="url",T="uuid",I="bigint",L="smallint",q="positivesmallint",B="image",U="file",V="object",K="array",R=[g,N,D,B,S,U],W=Object(v["a"])({},y,[K,V]),Y=[[y,g,N,B,U,S,T,P,b,I,L,q,M,w,A],[k,O,E]],z=(a={},Object(v["a"])(a,b,"\u6574\u6570"),Object(v["a"])(a,g,"\u5b57\u7b26\u4e32"),Object(v["a"])(a,y,"\u957f\u6587\u672c"),Object(v["a"])(a,j,"\u5e03\u5c14\u503c"),Object(v["a"])(a,O,"\u5f15\u7528"),Object(v["a"])(a,E,"\u591a\u5bf9\u591a"),Object(v["a"])(a,k,"\u4e00\u5bf9\u4e00"),Object(v["a"])(a,w,"\u5c0f\u6570"),Object(v["a"])(a,_,"\u65e5\u671f"),Object(v["a"])(a,x,"\u65e5\u671f\u65f6\u95f4"),Object(v["a"])(a,C,"\u65f6\u95f4"),Object(v["a"])(a,S,"\u7535\u5b50\u90ae\u4ef6"),Object(v["a"])(a,F,"\u81ea\u589e\u6574\u6570"),Object(v["a"])(a,A,"\u6d6e\u70b9\u6570"),Object(v["a"])(a,P,"ip\u5730\u5740"),Object(v["a"])(a,M,"\u975e\u8d1f\u6574\u6570"),Object(v["a"])(a,N,"\u7b80\u77ed\u6807\u8bc6"),Object(v["a"])(a,D,"URL"),Object(v["a"])(a,T,"\u552f\u4e00\u6807\u8bc6\u7b26"),Object(v["a"])(a,I,"\u5927\u6574\u6570"),Object(v["a"])(a,L,"\u5c0f\u6574\u6570"),Object(v["a"])(a,q,"\u5c0f\u6b63\u6574\u6570"),Object(v["a"])(a,B,"\u56fe\u7247"),Object(v["a"])(a,U,"\u6587\u4ef6"),Object(v["a"])(a,V,"\u5bf9\u8c61"),Object(v["a"])(a,K,"\u6570\u7ec4"),a),G={validateTypeSelected:function(e){var t=e.name,n=e.value,a=e.initialValue,r=e.form;R.includes(n)&&R.includes(a)||a in W&&W[a].includes(n)||Y[0].includes(a)&&Y[1].includes(n)||(setTimeout((function(){r.resetFields([t])}),1e3),h["a"].warning({title:"\u4e0d\u5408\u6cd5\u7684\u5b57\u6bb5\u7c7b\u578b\u8f6c\u6362",content:"\u4e0d\u652f\u6301\u5c06\u201c".concat(z[a],"\u201d\u5b57\u6bb5\u7c7b\u578b\u8f6c\u6362\u4e3a\u201c").concat(z[n],"\u201d\u5b57\u6bb5\u7c7b\u578b")}))}},H={fieldHandler:G},J=n("1hG1"),X=n("K/pY"),Z=n("fNJA"),Q=n("Lafb"),$=n("4WK3"),ee=n("EBSl");function te(){Object(ee["q"])({type:ee["d"],action:"add",name:"\u65b0\u5efa",rspType:ee["j"],title:$["a"],component:$["b"],callback:$["d"]}),Object(ee["q"])({type:ee["d"],action:"link",name:"\u94fe\u63a5",rspType:ee["i"],title:"\u94fe\u63a5"}),Object(ee["q"])({type:ee["d"],action:"info",name:"\u5f39\u7a97\u6d88\u606f",rspType:ee["h"],title:"\u5f39\u7a97\u6d88\u606f"})}var ne=n("gOIk");function ae(){Object(ee["q"])({type:ee["d"],action:"action",name:"\u4e91\u51fd\u6570",rspType:ee["e"],description:"\u81ea\u5b9a\u4e49\u6a21\u578b\u7ea7\u4e91\u51fd\u6570\uff0c\u53ea\u80fd\u591f\u6307\u5b9a\u51fd\u6570\u540d\u3002",paramsDef:[{name:"action",type:"string"}]})}var re=n("LvDl"),ie=n.n(re),ce=n("jfUH");function oe(){Object(ee["q"])({type:ee["c"],action:"link",name:"\u94fe\u63a5",rspType:ee["i"],title:"\u94fe\u63a5"}),Object(ee["q"])({type:ee["c"],action:"info",name:"\u5f39\u7a97\u6d88\u606f",rspType:ee["h"],title:"\u5f39\u7a97\u6d88\u606f"}),Object(ee["q"])({type:ee["c"],action:"action",name:"\u4e91\u51fd\u6570",rspType:ee["e"],title:"\u4e91\u51fd\u6570"}),Object(ee["q"])({type:ee["c"],action:"delete",name:"\u5220\u9664",rspType:ee["g"],title:"\u5220\u9664",func:function(e,t,n,a){var r=window.g_app._store.dispatch;return r({type:"content/delete",payload:{id:Object(ce["M"])(e,t),model:t}}).then((function(){a.refresh()}))}}),Object(ee["q"])({type:ee["c"],action:"patch",name:"\u90e8\u5206\u66f4\u65b0",rspType:ee["g"],title:"\u90e8\u5206\u66f4\u65b0",func:function(e,t,n,a){var r=window.g_app._store.dispatch,i=n.params.payload.fields,c=window.g_app._store.getState(),o=c.content.schemas,l=i.reduce((function(e,t){var n=e;return n[t.name]=t.value,n}),{});return ie.a.isEmpty(l)?null:r({type:"content/patch",payload:{model:t,id:Object(ce["M"])(e,t),newValues:l,schema:o[t]}}).then((function(){a.refresh()}))}})}function le(){Object(ee["q"])({type:ee["d"],action:"export",name:"\u5bfc\u51fa",rspType:ee["g"],title:"\u5bfc\u51fa",func:function(e,t,n){return n.exportData({exportKey:t.params})}})}function se(){var e=window.g_app._store.dispatch;Object(ee["q"])({type:ee["b"],action:"export",name:"\u5bfc\u51fa",rspType:ee["g"],title:"\u5bfc\u51fa",func:function(t,n,a,r){var i=a.params,c=i.choicesForField||Object(ce["N"])(n),o=[];return c&&o.push({field:c,operator:"in",value:t.map((function(e){return Object(ce["M"])(e,n)}))}),console.log("exporting excel with: ",i.model||n,o,i),e({type:"content/download",payload:{model:i.model||n,filters:o,exportKey:i}})}})}var ue=n("9og8"),de=(n("0zvD"),n("DIQE")),me=n("WmNS"),pe=n.n(me),fe=n("Cnxa"),he=n("fWQN"),ve=n("mtLc"),be=n("yKVA"),ge=n("879j"),ye=(n("eNCU"),n("pjJH")),je=(n("vmZS"),n("NjVP")),Oe=n("tJVT"),Ee=n("oORW"),ke=n("3V3B"),we=n("mmaM");function _e(e){var t=e.username,n=e.is_active,a=e.handleOk,c=Object(r["useState"])(),o=Object(Oe["a"])(c,2),l=o[0],s=o[1];function u(){return d.apply(this,arguments)}function d(){return d=Object(ue["a"])(pe.a.mark((function e(){return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(we["setUserPassword"])({username:t,password:l,is_active:n});case 2:a();case 3:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}return i.a.createElement("div",null,i.a.createElement("div",{style:{width:400,margin:"auto"}},i.a.createElement(je["a"],{layout:"horizontal",labelCol:{span:4},wrapperCol:{span:19}},i.a.createElement(je["a"].Item,{label:"\u5bc6\u7801",labelAlign:"right",required:!0},i.a.createElement(Ee["a"],{value:l,onChange:function(e){return s(e)}}))),i.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:16}},i.a.createElement(ye["a"],{type:"primary",onClick:u},"\u63d0\u4ea4"))))}var xe=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(){var e;Object(he["a"])(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),e.state={groups:[]},e.onSubmit=Object(ue["a"])(pe.a.mark((function t(){var n,a,r,i,c;return pe.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.props,a=n.username,r=n.handleOk,i=n.is_active,c=e.state.groups,t.next=4,Object(we["setUserGroups"])({username:a,groups:c.map((function(e){return e.id})),is_active:i});case 4:r();case 5:case"end":return t.stop()}}),t)}))),e}return Object(ve["a"])(n,[{key:"componentWillMount",value:function(){var e=Object(ue["a"])(pe.a.mark((function e(){var t,n,a,r;return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props,n=t.username,a=t.is_active,e.next=3,Object(we["getUserGroups"])({username:n,is_active:a});case 3:r=e.sent,this.setState({groups:r});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e=this,t=window.g_app._store.getState(),n=t.content.schemas,a=this.state.groups;return i.a.createElement("div",null,i.a.createElement("div",{style:{width:400,margin:"auto"}},i.a.createElement(je["a"],{layout:"horizontal",labelCol:{span:4},wrapperCol:{span:19}},i.a.createElement(je["a"].Item,{label:"\u89d2\u8272",required:!0},i.a.createElement(ke["a"],{field:n.member__user.fields.find((function(e){return"groups"===e.name})),onChange:function(t){return e.setState({groups:t})},value:a}))),i.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:16}},i.a.createElement(ye["a"],{type:"primary",onClick:this.onSubmit},"\u63d0\u4ea4"))))}}]),n}(i.a.Component),Ce=n("fVK0"),Se=n("9uep"),Fe=n("vbsh"),Ae=(n("T2oS"),n("W9HT")),Pe=(n("/zsF"),n("PArb")),Me=(n("Dvpn"),n("myml")),Ne=(n("DZo9"),n("8z0m")),De=(n("+L6B"),n("2/Rp")),Te=(n("eE3J"),n("GSZB")),Ie=n("oBTY"),Le=n("k1fw"),qe=(n("/xke"),n("TeRw")),Be=(n("miYZ"),n("tsqr")),Ue=n("wd/R"),Ve=n.n(Ue),Ke=n("/MKj");function Re(e,t){var n=e.split("\uff08");return n.length>=2&&e.endsWith("\uff09")?n[n.length-1].slice(0,-1):e in t?t[e]:null}var We=function(e){Object(be["a"])(a,e);var t=Object(ge["a"])(a);function a(){var e;Object(he["a"])(this,a);for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];return e=t.call.apply(t,[this].concat(c)),e.state={uploadingText:"\u9009\u62e9\u6587\u4ef6",uploadingList:[],loading:!1,excelData:[],errors:[]},e.handleChange=function(t){var n=t.file,a=e.props.fetch;if("removed"===n.status?e.setState({uploadingList:[],excelData:[]}):e.setState({uploadingList:[n]}),"error"===n.status&&(console.error("\u4e0a\u4f20\u6587\u4ef6\u9519\u8bef\u4e86: ",n.response),h["a"].error({title:"\u5bfc\u5165\u6587\u4ef6\u65f6\u53d1\u751f\u672a\u77e5\u9519\u8bef",content:i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"\u5bfc\u5165\u6587\u4ef6\u65f6\u4e2d\u53d1\u751f\u4e86\u5982\u4e0b\u9519\u8bef\uff0c\u8bf7\u53ca\u65f6\u8054\u7cfb\u7cfb\u7edf\u7ba1\u7406\u5458"),i.a.createElement("p",null,n.response))})),"done"===n.status){console.log("\u4e0a\u4f20\u72b6\u6001\u4e3aDone\u4e86: ",n.response);var r=n.response;"10000"===r.error_code?e.setState({errors:r.error_data}):"0"===r.error_code?(Be["default"].success("\u5bfc\u5165\u6570\u636e\u6210\u529f"),a()):h["a"].error({title:"\u5bfc\u5165\u6587\u4ef6\u65f6\u53d1\u751f\u4ee3\u53f7\u4e3a\u201c".concat(r.error_code,"\u201d\u7684\u9519\u8bef"),content:i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"\u5bfc\u5165\u6587\u4ef6\u65f6\u4e2d\u53d1\u751f\u4e86\u5982\u4e0b\u9519\u8bef\uff0c\u8bf7\u53ca\u65f6\u8054\u7cfb\u7cfb\u7edf\u7ba1\u7406\u5458"),i.a.createElement("p",null,"\u9519\u8bef\u8bf4\u660e\uff1a",r.error_message),i.a.createElement("p",null,"\u9519\u8bef\u6570\u636e\uff1a",r.error_data))})}},e.forEachHeader=function(t){var n=e.props,a=n.model,r=n.content.schemas;r[a].fields.forEach((function(e){Object(ce["z"])(e)||e.primaryKey||(Object(ce["D"])(e)?r[e.ref].fields.forEach((function(n){Object(ce["B"])(n)||n.primaryKey||t([e,n])})):t([e]))}))},e.handleCancel=Object(ue["a"])(pe.a.mark((function t(){var n,a,r,c,o,l,s,u,d;return pe.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.props,a=n.model,r=n.fetch,c=n.content.schemas,o=e.state.excelData,!ie.a.isEmpty(o)){t.next=5;break}return Be["default"].error("\u5bfc\u5165\u5931\u8d25"),t.abrupt("return");case 5:if(l={},!ie.a.isEmpty(c[a])){t.next=9;break}return Be["default"].info("\u6a21\u578b\u6ca1\u6709\u5b57\u6bb5"),t.abrupt("return");case 9:return e.forEachHeader((function(e){var t=ie.a.last(e);t&&t.choices&&(l[e.map((function(e){return e.name})).join(".")]=t.choices)})),s=Be["default"].loading({content:"\u5bfc\u5165\u4e2d,\u8bf7\u52ff\u5173\u95ed\u7a97\u53e3",duration:0,key:"DataImport"}),e.setState({loading:!0}),u={},c[a].fields.forEach((function(e){u[e.displayName]=e.name})),d=o.map((function(e){var t={};return Object.keys(e).forEach((function(n){var r=Re(n,u);if(r){t[r]=e[n],l[r]&&l[r].forEach((function(a){e[n]===a[1]&&(t[r]=a[0])}));var i=Object(ce["t"])(a,r,c);if(i&&"date"===i.type){var o=Ve()(t[r]);o.isValid()?t[r]=o.format("YYYY-MM-DD"):delete t[r]}}})),t})).map((function(e){var t={};return Object.entries(e).forEach((function(e){var n=Object(Oe["a"])(e,2),a=n[0],r=n[1];if(a.includes(".")){var i=a.split("."),c=Object(Oe["a"])(i,2),o=c[0],l=c[1];o in t||(t[o]={}),t[o][l]=r}else t[a]=r})),t})),t.prev=15,t.next=18,Object(we["createContent"])({model:a,values:d},{msgOption:!1});case 18:Be["default"].success({content:"\u5bfc\u5165\u6210\u529f",key:"DataImport"}),r(),t.next=26;break;case 22:t.prev=22,t.t0=t["catch"](15),s(),qe["default"].error({message:"\u5bfc\u5165\u5931\u8d25",description:t.t0.error_data.filter(ie.a.negate(ie.a.isEmpty)).map((function(e){return ie.a.map(e,(function(e,t){return"".concat(t,": ").concat(e.join("\uff0c"))})).join("")})).map((function(e,t){return i.a.createElement("div",null,t+2,"\uff1a",e)}))});case 26:return t.prev=26,e.setState({loading:!1,uploadingList:[],excelData:[]}),t.finish(26);case 29:case"end":return t.stop()}}),t,null,[[15,22,26,29]])}))),e.getExpandFields=function(){var t=e.props.model;return Object(we["getExpandFields"])(t)},e.getCharCol=function(e){var t="",n=0,a=e;while(a>0)n=a%26+1,t=String.fromCharCode(n+64)+t,a=(a-n)/26;return"".concat(t,"1")},e.exportMesh=function(){var t=e.props,a=t.model,r=t.config,i=t.content.schemas;if(null!==r&&void 0!==r&&r.template)window.open(r.template,"__blank");else{var c=[];if(ie.a.isEmpty(i[a]))Be["default"].info("\u6a21\u578b\u6ca1\u6709\u5b57\u6bb5");else{e.forEachHeader((function(e){c.push("".concat(e.map((function(e){return e.displayName})).join(""),"\uff08").concat(e.map((function(e){return e.name})).join("."),"\uff09"))}));var o=c.map((function(e){return{title:e,dataIndex:e,key:e}})),l=o.map((function(t,n){return{key:t.key,title:t.title,position:n>25?e.getCharCol(n):String.fromCharCode(65+n)+1}})).reduce((function(e,t){return Object(Le["a"])(Object(Le["a"])({},e),{},Object(v["a"])({},t.position,{key:t.key,v:t.title}))}),{}),s=Object.keys(l),u="".concat(s[0],":").concat(s[s.length-1]),d=o.map((function(){return{wpx:80}})),m={SheetNames:[a],Sheets:Object(v["a"])({},a,Object(Le["a"])(Object(Le["a"])({},l),{},{"!ref":u,"!cols":d}))};Promise.all([n.e(35),n.e(27)]).then(n.bind(null,"vSpB")).then((function(e){var t=e.XLSX.writeFile;t(m,"".concat(a,".xlsx"))}))}}},e.onImportExcel=function(t){var a=[],r=e.props.config;if(!ie.a.isEmpty(r))return e.setState({uploadingText:"\u91cd\u65b0\u9009\u62e9",errors:[]}),!0;var i=new FileReader;return i.readAsBinaryString(t),i.onload=function(t){var r=function(){return Be["default"].error({content:"\u6587\u4ef6\u89e3\u91ca\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9",key:"uploadExcel"})};Promise.all([n.e(35),n.e(27)]).then(n.bind(null,"vSpB")).then((function(n){var i=n.XLSX,c=i.read,o=i.utils;if(t.target)try{var l=t.target.result,s=c(l,{type:"binary",cellDates:!0}),u=s.Sheets;Object.keys(u).forEach((function(e){a=a.concat(o.sheet_to_json(u[e]))})),e.setState({uploadingText:"\u91cd\u65b0\u9009\u62e9",excelData:a})}catch(d){r()}else r()})).catch(r)},!1},e}return Object(ve["a"])(a,[{key:"render",value:function(){var e=this.state,t=e.uploadingText,n=e.uploadingList,a=e.loading,r=e.excelData,c=e.errors,o=this.props,l=o.config,s=o.model,u=o.superior,d="/basebone/".concat(s,"/import/file/"),m={import_config:JSON.stringify(l)};u&&(m.detail_id=u.id,m.detail_model=u.model,m.detail_field=u.field);var p=[{title:"\u884c\u53f7",dataIndex:"line",key:"line"}];return null!==l&&void 0!==l&&l.list_mapping&&p.push.apply(p,Object(Ie["a"])(null===l||void 0===l?void 0:l.list_mapping.map((function(e){return{title:"\u5217".concat(e.column),dataIndex:["error",e.field],key:"error".concat(e.field),render:function(e){return null===e||void 0===e?void 0:e.join("\n")}}})))),i.a.createElement(i.a.Fragment,null,i.a.createElement(Ae["a"],{spinning:a},null!==l&&void 0!==l&&l.template||ie.a.isEmpty(l)?i.a.createElement("p",null,i.a.createElement("a",{onClick:this.exportMesh},"\u70b9\u51fb\u4e0b\u8f7d\u6a21\u677f"),"\u5e76\u6309\u6a21\u677f\u7f16\u8f91\u9700\u5bfc\u5165\u7684\u6570\u636e\u3002"):i.a.createElement(i.a.Fragment,null),i.a.createElement("b",null,"\u63d0\u793a\uff1a"),null!==l&&void 0!==l&&l.description?i.a.createElement("pre",null,l.description):i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"1. \u5f53\u524d\u4ec5\u652f\u6301.xls\u4ee5\u53ca.xlsx\u683c\u5f0f\u7684Excel\u6587\u4ef6\u5bfc\u5165\u3002"),i.a.createElement("p",null,"2. \u6a21\u677f\u4e2d\u7684\u5b57\u6bb5\u5de6\u53f3\u987a\u5e8f\u53ef\u4ee5\u8c03\u6574\uff0c\u4f46\u4e0d\u8981\u4fee\u6539\u8868\u5934\uff0c\u4ee5\u514d\u5bfc\u5165\u65f6\u65e0\u6cd5\u8bc6\u522b\u6570\u636e\u3002"),i.a.createElement("p",null,"3. \u53ef\u5220\u9664\u6a21\u677f\u4e2d\u4e00\u4e9b\u975e\u5fc5\u586b\u7684\u5b57\u6bb5\u3002"),i.a.createElement("p",null,"4. \u6587\u4ef6\u4e2d\u7684\u6570\u636e\u5747\u4f5c\u4e3a\u65b0\u589e\u6570\u636e\u4fdd\u5b58\u5230\u7cfb\u7edf\u4e2d\u3002")),i.a.createElement(Ne["a"],{name:"file",action:d,data:m,accept:".xlsx,.xls",beforeUpload:this.onImportExcel,fileList:n,withCredentials:!0,onChange:this.handleChange},i.a.createElement(De["a"],null,i.a.createElement(Te["a"],{type:"upload"}),t),"\xa0"),i.a.createElement("br",null),c.length>0&&i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,i.a.createElement("span",{style:{color:"red"}},"\u5bfc\u5165\u7684\u6570\u636e\u6709\u8bef\uff0c\u8bf7\u4fee\u6b63\u540e\u91cd\u65b0\u5bfc\u5165\uff0c\u9519\u8bef\u4fe1\u606f\u89c1\u4e0b\u8868\uff1a")),i.a.createElement(Me["a"],{dataSource:c,columns:p,size:"small",scroll:{y:200},pagination:!1})),ie.a.isEmpty(l)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Pe["a"],null),i.a.createElement("div",{style:{textAlign:"right"}},i.a.createElement(i.a.Fragment,null,i.a.createElement(De["a"],{type:"primary",disabled:0===r.length,onClick:this.handleCancel},i.a.createElement(Te["a"],{type:"upload"})," \u5f00\u59cb\u5bfc\u5165"))))))}}]),a}(r["Component"]),Ye=Object(Ke["c"])((function(e){var t=e.content;return{content:t}}))(We),ze=(n("Pwec"),n("CtXQ")),Ge=(n("2qtc"),n("kLXV")),He=(n("IzEo"),n("bx4M")),Je=(n("Znn+"),n("ZTPi")),Xe=(n("g9YV"),n("wCAj")),Ze=(n("OaEy"),n("2fM7")),Qe=(n("Mwp2"),n("VXEj")),$e=(n("sRBo"),n("kaz8")),et=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(){var e;Object(he["a"])(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r)),e.state={selectOption:[],checkBoxModels:[],allCheckBoxModels:[],subStep:!1,appData:void 0,loading:!1,modelData:void 0,checkBoxsAll:!0},e.handleSubmit=Object(ue["a"])(pe.a.mark((function t(){var n,a,r,i,c,o,l;return pe.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.props.fetch,a=e.state,r=a.checkBoxModels,i=a.appData,c=a.loading,o=a.modelData,!ie.a.isEmpty(r)){t.next=5;break}return Be["default"].info("\u8bf7\u9009\u62e9\u6a21\u578b"),t.abrupt("return");case 5:if(i){t.next=8;break}return Be["default"].info("\u8bf7\u9009\u62e9\u6a21\u5757"),t.abrupt("return");case 8:return Be["default"].loading({content:"\u5bfc\u5165\u4e2d,\u8bf7\u52ff\u5173\u95ed\u7a97\u53e3",duration:0,key:"ModelImport"}),c||e.setState({loading:!0}),t.prev=10,l=[],o.forEach(function(){var e=Object(ue["a"])(pe.a.mark((function e(t){return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object.keys(t).forEach((function(e){r.includes(e)&&l.push(t[e].metaModel)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.next=15,Object(we["createContent"])({model:"meta__model",values:l});case 15:return t.next=17,Object(we["cloudFunc"])({model:"meta__model",functionName:"migrate"});case 17:o.forEach(function(){var e=Object(ue["a"])(pe.a.mark((function e(t){return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object.keys(t).forEach(function(){var e=Object(ue["a"])(pe.a.mark((function e(n){return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r.includes(n)){e.next=3;break}return e.next=3,Object(we["createContent"])({model:"".concat(i.name,"__").concat(n),values:t[n].data});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Be["default"].success({content:"\u5bfc\u5165\u6210\u529f",key:"ModelImport"}),t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](10),Be["default"].error({content:"\u5bfc\u5165\u5931\u8d25",key:"ModelImport"});case 24:return t.prev=24,e.handleClose(),e.setState({loading:!1}),n(),t.finish(24);case 29:case"end":return t.stop()}}),t,null,[[10,21,24,29]])}))),e.handleClose=function(){var t=e.props.closeModal;t(),e.setState({checkBoxModels:[],subStep:!1,appData:void 0})},e.handleAppChange=function(t){var n=e.state.modelData,a=[];n.forEach((function(e){return Object.keys(e).forEach((function(n){var r=e;r[n].metaModel.app=t.id,a.push(r)}))})),e.setState({appData:t,modelData:a})},e.onChangeAllCheckboxs=function(t){var n=e.state.allCheckBoxModels;e.setState({checkBoxModels:t.target.checked?n:[],checkBoxsAll:t.target.checked})},e.onChangeCheckboxs=function(t,n){var a=e.state,r=a.checkBoxModels,i=a.allCheckBoxModels,c=r||[];n?c.includes(t)||c.push(t):c=c.filter((function(e){return e!==t})),e.setState({checkBoxModels:c,checkBoxsAll:c.length===i.length})},e.modalFoot=function(){var t=e.state,n=t.subStep,a=t.checkBoxModels,r=t.loading;return n?[i.a.createElement(De["a"],{onClick:function(){return e.setState({subStep:!n})},disabled:r},"\u4e0a\u4e00\u6b65"),i.a.createElement(De["a"],{key:"submit",type:"primary",onClick:e.handleSubmit,loading:r},"\u5bfc\u5165")]:[i.a.createElement(De["a"],{onClick:function(){ie.a.isEmpty(a)?Be["default"].info("\u8bf7\u9009\u62e9\u6a21\u578b"):e.setState({subStep:!n})},disabled:r},"\u9884\u89c8"),i.a.createElement(De["a"],{key:"submit",type:"primary",onClick:e.handleSubmit,loading:r},"\u5bfc\u5165")]},e}return Object(ve["a"])(n,[{key:"componentWillMount",value:function(){var e=Object(ue["a"])(pe.a.mark((function e(){var t,n,a;return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.props.uploadData,e.next=3,Object(we["queryContent"])({model:"meta__app"});case 3:n=e.sent,a=[],t.forEach((function(e){Object.keys(e).forEach((function(e){return a.push(e)}))})),this.setState({selectOption:n.list,modelData:t,allCheckBoxModels:a,checkBoxModels:a});case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e=this,t=this.state,n=t.selectOption,a=t.checkBoxModels,r=t.subStep,c=t.appData,o=t.loading,l=t.modelData,s=t.checkBoxsAll;return i.a.createElement(i.a.Fragment,null,!ie.a.isEmpty(l)&&i.a.createElement(Ge["a"],{title:"\u5bfc\u5165",visible:!ie.a.isEmpty(l),onCancel:o?"":this.handleClose,maskClosable:!1,width:r?"70%":"50%",destroyOnClose:!0,footer:this.modalFoot()},i.a.createElement(Ae["a"],{spinning:o},i.a.createElement("div",null,!r&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Qe["b"],{header:i.a.createElement(i.a.Fragment,null,"\u9009\u62e9\u6a21\u578b",i.a.createElement($e["a"],{onChange:this.onChangeAllCheckboxs,checked:s,style:{float:"right"}},"\u5168\u9009")),bordered:!0,style:{width:"70%",margin:"auto"},size:"large"},i.a.createElement($e["a"].Group,{style:{width:"100%"},value:a},l.map((function(t){return Object.keys(t).map((function(t){return i.a.createElement(Qe["b"].Item,null,i.a.createElement($e["a"],{onChange:function(n){e.onChangeCheckboxs(t,n.target.checked)},value:t},t))}))})))),i.a.createElement("div",{style:{width:"100%",marginBottom:20,marginTop:30,textAlign:"center"}},"\u9009\u62e9\u6a21\u5757\uff1a",i.a.createElement(Ze["a"],{style:{paddingLeft:10,width:"62%"},onChange:this.handleAppChange,defaultValue:c},n.map((function(e){return i.a.createElement(Ze["a"].Option,{value:e},e.name)}))))),!ie.a.isEmpty(a)&&r&&i.a.createElement(Je["a"],{tabPosition:"bottom"},l.map((function(e){return Object.keys(e).map((function(t){if(!a.includes(t))return null;var n=Object(Ie["a"])(e[t].metaModel.fields.map((function(e){return{title:e.verbose_name,dataIndex:e.name,key:e.name,editable:!0}})));return i.a.createElement(Je["a"].TabPane,{tab:t,key:t},i.a.createElement(He["a"],{bordered:!0,style:{marginBottom:-16,borderBottom:"none"}},i.a.createElement(Je["a"],null,i.a.createElement(Je["a"].TabPane,{tab:"\u7ed3\u6784",key:"\u7ed3\u6784"},i.a.createElement(Xe["a"],{columns:[{title:"\u5b57\u6bb5\u540d",dataIndex:"name",key:"name"},{title:"\u663e\u793a\u540d",dataIndex:"verbose_name",key:"verbose_name"},{title:"\u7c7b\u578b",dataIndex:"type",key:"type"}],dataSource:e[t].metaModel.fields,pagination:{pageSize:7}})),i.a.createElement(Je["a"].TabPane,{tab:"\u6570\u636e",key:"\u6570\u636e"},i.a.createElement(Xe["a"],{columns:n,dataSource:e[t].data,pagination:{pageSize:7},bordered:!0})))))}))})))))))}}]),n}(r["Component"]),tt=et,nt=function(e){Object(be["a"])(a,e);var t=Object(ge["a"])(a);function a(){var e;Object(he["a"])(this,a);for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];return e=t.call.apply(t,[this].concat(i)),e.state={uploadingList:[],uploadData:[]},e.handleChange=function(t){var n=t.file;e.setState({uploadingList:[{uid:n.uid,name:n.name}]})},e.onImportExcel=function(){var t=Object(ue["a"])(pe.a.mark((function t(a){var r,i,c,o,l,s,u,d;return pe.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([n.e(35),n.e(27)]).then(n.bind(null,"vSpB"));case 2:if(r=t.sent,i=r.XLSX,c=r.pinyin,o=[],l=new FileReader,s=e.state.uploadData,l.readAsBinaryString(a),ie.a.isEmpty(s)||e.setState({uploadData:[]}),u=a.name.lastIndexOf("."),d=a.name.substring(u),[".xlsx",".xls",".csv"].includes(d)){t.next=16;break}return e.setState({uploadData:[]}),Be["default"].error("\u4e0a\u4f20\u5931\u8d25"),t.abrupt("return");case 16:l.onload=function(t){try{var n=t.target.result,a=i.read(n,{type:"binary",cellDates:!0}),r=a.Sheets;Object.keys(r).forEach((function(e){if(r[e]["!ref"]){for(var t=[],n=[],a=[],l=c(e,{style:c.STYLE_NORMAL}).join(""),s=i.utils.decode_range(r[e]["!ref"]).e.c,u=0;u<=s;u+=1){var d="".concat(i.utils.encode_col(u),"1");if(r[e][d]&&"s"===r[e][d].t&&r[e][d].v.trim().length>0){var m=c(r[e][d].v,{style:c.STYLE_NORMAL}).join("");r[e][d].w=m,r[e][d].v=m,r[e][d].t=void 0,a.push(d)}}Object.keys(r[e]).forEach((function(t){var n="".concat(t.replace(/[0-9]+/g,""),"1");if(!["!ref","!margins"].includes(t)&&t!==n)if(r[e][n].t)if("n"===r[e][t].t){"d"!==r[e][n].t&&"s"!==r[e][n].t||(r[e][n].t="s");var a=Math.floor(r[e][t].v);a!==r[e][t].v&&(r[e][n].t="f")}else"d"===r[e][t].t?"d"!==r[e][n].t&&(r[e][n].t="s"):"s"===r[e][t].t&&(r[e][n].t="s");else r[e][n].t=r[e][t].t})),Object.keys(r[e]).forEach((function(t){var n="".concat(t.replace(/[0-9]+/g,""),"1");["!ref","!margins"].includes(t)||r[e][n].t||(r[e][n].t="s"),["!ref","!margins"].includes(t)||t===n||("s"===r[e][n].t&&(r[e][t].t=r[e][n].t,r[e][t].v="".concat(r[e][t].v)),"n"===r[e][n].t&&(r[e][t].v=Math.floor(r[e][t].v)))})),t=t.concat(i.utils.sheet_to_json(r[e])),a.forEach((function(t){"n"===r[e][t].t&&(r[e][t].t="int"),"f"===r[e][t].t&&(r[e][t].t="float"),"s"===r[e][t].t&&(r[e][t].t="text"),"d"===r[e][t].t&&(r[e][t].t="date"),n.push({name:r[e][t].v,type:r[e][t].t,verbose_name:r[e][t].h,null:!0})}));var p={name:l,table_name:e,verbose_name:l,fields:n};o.push(Object(v["a"])({},l,{metaModel:p,data:t}))}})),e.setState({uploadData:o}),Be["default"].success("\u4e0a\u4f20\u6210\u529f")}catch(l){Be["default"].error("\u4e0a\u4f20\u5931\u8d25")}};case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(ve["a"])(a,[{key:"render",value:function(){var e=this,t=this.state,n=t.uploadingList,a=t.uploadData,r=this.props.fetch;return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ne["a"],{name:"excel",action:"",accept:".xlsx,.xls,.csv",beforeUpload:this.onImportExcel,fileList:n,onChange:this.handleChange},i.a.createElement(De["a"],null,i.a.createElement(ze["a"],{type:"upload"}),"\u4e0a\u4f20Excel")),!ie.a.isEmpty(a)&&i.a.createElement(tt,{uploadData:a,closeModal:function(){return e.setState({uploadingList:[],uploadData:[]})},fetch:r}))}}]),a}(r["Component"]),at=nt;function rt(e){var t=e.model;e.config;if(t)return"meta__model"===t?i.a.createElement(at,e):i.a.createElement(Ye,e)}var it,ct,ot=n("Utjr"),lt=Object(ot["d"])((function(){return n.e(9).then(n.bind(null,"z2hv"))}),{loading:i.a.createElement(de["a"],{active:!0})});function st(){Object(ee["q"])({type:ee["c"],action:"intermediaryConfig",name:"\u4e2d\u95f4\u8868\u8bbe\u7f6e",rspType:ee["j"],component:function(e){var t=e.currentObject,n=e.currentActionObject,a=e.context;return i.a.createElement(fe["a"],{record:t,action:n.action,closeModal:function(){return a.refresh()}})},model:"meta__model",title:"\u4e2d\u95f4\u8868\u8bbe\u7f6e"}),Object(ee["q"])({type:ee["d"],action:"install_database",name:"\u589e\u52a0\u6570\u636e\u5e93",rspType:ee["j"],component:function(e){var t=e.context.refresh;return i.a.createElement(lt,{appendMode:!0,onOk:t})},model:"db_tool__setting",title:"\u6570\u636e\u5e93\u5b89\u88c5\u5411\u5bfc",autoAdd:!0}),Object(ee["q"])({type:ee["c"],action:"setPassword",name:"\u91cd\u8bbe\u5bc6\u7801",rspType:ee["j"],title:"\u91cd\u8bbe\u5bc6\u7801",model:function(e){var t=e.setting;return t.staff_model},permission:Ce["b"].SETTING_CUSTOM_STAFF,component:function(e){var t=e.currentObject,n=e.context.refresh,a=window.g_app._store.getState(),r=a.bsmSetting;return i.a.createElement(_e,{username:t[r.staff_username],handleOk:n,is_active:t[r.staff_active]})},autoAdd:!0}),Object(ee["q"])({type:ee["c"],action:"setGroups",name:"\u8bbe\u7f6e\u89d2\u8272",rspType:ee["j"],title:"\u8bbe\u7f6e\u89d2\u8272",model:function(e){var t=e.setting;return t.staff_model},permission:Ce["b"].SETTING_CUSTOM_STAFF,component:function(e){var t=e.currentObject,n=e.context.refresh,a=window.g_app._store.getState(),r=a.bsmSetting;return i.a.createElement(xe,{username:t[r.staff_username],handleOk:n,is_active:t[r.staff_active]})},autoAdd:!0}),Object(ee["q"])({type:ee["c"],action:"syncAccountStatus",name:"\u66f4\u65b0\u6709\u6548\u72b6\u6001",rspType:ee["g"],title:"\u66f4\u65b0\u6709\u6548\u72b6\u6001",model:function(e){var t=e.setting;return t.staff_model},permission:Ce["b"].SETTING_CUSTOM_STAFF,func:function(){var e=Object(ue["a"])(pe.a.mark((function e(t){var n,a;return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=window.g_app._store.getState(),a=n.bsmSetting,e.next=3,Object(we["upDateActive"])({username:t[a.staff_username],is_active:t[a.staff_active]});case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),autoAdd:!0}),Object(ee["q"])({type:ee["d"],action:"syncWechatAccounts",name:"\u540c\u6b65\u4f01\u4e1a\u5fae\u4fe1\u7528\u6237",title:"\u540c\u6b65\u4f01\u4e1a\u5fae\u4fe1\u7528\u6237",rspType:ee["e"],cloudFunc:"export_wechat_work_departmemt_user",model:"member__user",shouldShow:function(e){var t=e.setting;return"wechat"===t.third_party_provider},autoAdd:!0}),Object(ee["q"])({type:ee["d"],rspType:ee["e"],action:"syncDingdingAccounts",name:"\u540c\u6b65\u9489\u9489\u7528\u6237",title:"\u540c\u6b65\u9489\u9489\u7528\u6237",cloudFunc:"export_dingding_departmemt_user",model:"member__user",shouldShow:function(e){var t=e.setting;return"dingding"===t.third_party_provider},autoAdd:!0}),Object(ee["q"])({type:ee["c"],rspType:ee["f"],action:"pageConfig",name:"\u9875\u9762\u914d\u7f6e",title:"\u9875\u9762\u914d\u7f6e",model:"meta__model",component:function(e){var t=e.currentObject,n=e.context.hideDrawer,a="".concat(t.app_label,"__").concat(t.name).toLowerCase();return i.a.createElement(Se["a"],{afterSubmit:n,modelName:a,key:a})},autoAdd:!0}),Object(ee["q"])({type:ee["d"],action:"sync_models",name:"\u4ece\u6570\u636e\u5e93\u540c\u6b65",model:"meta__model",rspType:ee["e"],cloudFunc:"sync_models",callback:function(){var e=window.g_app._store.dispatch;return e({type:"content/getConfig"}).then((function(){e({type:"user/fetchCurrent"}),Object(Fe["d"])("bsm_config__menu",Fe["b"].afterUpdate)}))}})}function ut(e){var t=e.model,n=e.value,a=e.onChange,c=e.schemas,o=c&&t&&c[t].fields||[];return Object(r["useEffect"])((function(){it=t,ct=t}),[]),Object(r["useEffect"])((function(){it===t&&ct===t||a(""),ct=t}),[t]),i.a.createElement(u["a"],{onChange:a,value:n,allowClear:!0},o.map((function(e){return i.a.createElement(u["a"].Option,{key:e.name},e.name," (",e.displayName,")")})))}function dt(){Object(d["f"])("JSONCommonField",m["a"]),Object(d["f"])("License",p["a"]),Object(f["b"])("meta__field",H),Object(d["f"])("PermissionSelect",J["a"]),Object(d["f"])("ModelSelect",X["a"]),Object(d["f"])("FieldSelect",ut),Object(Z["c"])(Z["a"],"generate","\u751f\u6210\u6570\u636e",Q["a"]),Object($["c"])(),te(),Object(ne["a"])(),ae(),oe(),le(),se(),st()}Object(ee["q"])({type:ee["d"],action:"excelImport",name:"\u5bfc\u5165",rspType:ee["j"],title:"\u5bfc\u5165",permission:Ce["b"].SETTING_CUSTOM_STAFF,component:function(e){var t=e.model,n=e.currentActionParams,a=e.context,r=a.refresh,c=a.superior;return i.a.createElement(rt,{config:n,model:t,fetch:r,superior:c})},width:"50%"});var mt=n("0Owb"),pt=n("PpiC"),ft=n("WHYC"),ht={get:function(e){return e._routeInternalComponent},has:function(e){return void 0!==e._routeInternalComponent},set:function(e,t){e._routeInternalComponent=t}},vt=function(e){var t=e.path,n=e.exact,a=e.strict,r=e.render,c=e.location,o=e.sensitive,l=Object(pt["a"])(e,["path","exact","strict","render","location","sensitive"]);return i.a.createElement(ft["b"],{path:t,exact:n,strict:a,location:c,sensitive:o,render:function(e){return r(Object(Le["a"])(Object(Le["a"])({},e),l))}})};function bt(e){if(ht.has(e))return ht.get(e);var t=e.Routes,n=t.length-1,a=function(e){var t=e.render,n=Object(pt["a"])(e,["render"]);return t(n)},r=function(){var e=t[n],r=a;a=function(t){return i.a.createElement(e,t,i.a.createElement(r,t))},n-=1};while(n>=0)r();var c=function(t){var n=t.render,r=Object(pt["a"])(t,["render"]);return i.a.createElement(vt,Object(mt["a"])({},r,{render:function(t){return i.a.createElement(a,Object(mt["a"])({},t,{route:e,render:n}))}}))};return ht.set(e,c),c}var gt=!1;function yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e?i.a.createElement(ft["d"],n,e.map((function(e,n){if(e.redirect)return i.a.createElement(ft["a"],{key:e.key||n,from:e.path,to:e.redirect,exact:e.exact,strict:e.strict});var a=e.Routes?bt(e):vt;return i.a.createElement(a,{key:e.key||n,path:e.path,exact:e.exact,strict:e.strict,sensitive:e.sensitive,render:function(n){var a=n.location;gt&&(t={});var r=yt(e.routes,t,{location:a});if(e.component){var c=e.component;return i.a.createElement(c,Object(mt["a"])({key:e.path},n,{route:e}),r)}return r}})}))):null}n("SePM");var jt,Ot=n("PMX6"),Et={namespace:"bsmSetting",state:null!==(jt=window.$$settings)&&void 0!==jt?jt:{},effects:{getSettings:pe.a.mark((function e(t,n){var a,r,i;return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=n.call,r=n.put,e.next=3,a(we["getSettings"]);case 3:return i=e.sent,e.next=6,r({type:"changeSettings",payload:i});case 6:return e.next=8,r({type:"saveSettings",payload:i});case 8:case"end":return e.stop()}}),e)})),changeSettings:pe.a.mark((function e(t,n){var a,r,i,c;return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.payload,r=n.put,i=Object.keys(a),c={},i.forEach((function(e){void 0!==a[e]&&(c[e]=a[e])})),e.next=7,r({type:"setting/changeDefaultSettings",payload:c});case 7:case"end":return e.stop()}}),e)}))},reducers:{saveSettings:function(e,t){var n=t.payload;return Object(Le["a"])(Object(Le["a"])({},e),n)}}},kt=n("txBY"),wt=n("9kvl"),_t=Object(wt["a"])();window.g_app=_t,_t.$bsmRegisted||(_t.$bsmRegisted=!0,_t.model(Et),_t.model(kt["b"]));var xt=[{path:"/lightning",redirect:"/"},{path:"/",view:i.a.createElement(Ot["a"],{loading:!0})},{path:"/account/settings",component:n.e(48).then(n.bind(null,"0tIf")),routes:[{path:"/account/settings",component:n.e(47).then(n.bind(null,"NmtZ"))}]},{path:"/dashboard/charts",component:Promise.all([n.e(21),n.e(44)]).then(n.bind(null,"lYqw"))},{path:"/puzzle/:puzzle",component:Promise.all([n.e(3),n.e(21),n.e(43),n.e(2),n.e(42)]).then(n.bind(null,"RWMg"))},{path:"/content/:model/map",component:n.e(51).then(n.bind(null,"Iw0d"))},{path:"/content/trigger_core__trigger/add",component:Promise.all([n.e(12),n.e(5),n.e(15)]).then(n.bind(null,"PsOX"))},{path:"/content/trigger_core__trigger/edit/:id",component:Promise.all([n.e(12),n.e(5),n.e(15)]).then(n.bind(null,"PsOX"))},{path:"/content/api_db__api/add",component:Promise.all([n.e(5),n.e(19)]).then(n.bind(null,"r7nV"))},{path:"/content/api_db__api/edit/:id",component:Promise.all([n.e(5),n.e(19)]).then(n.bind(null,"r7nV"))},{path:"/content/:model",component:Promise.all([n.e(3),n.e(17),n.e(2),n.e(4),n.e(13)]).then(n.bind(null,"zrVq"))},{path:"/content/:model/add",component:Promise.all([n.e(3),n.e(7),n.e(2),n.e(4),n.e(6)]).then(n.bind(null,"Xjaj"))},{path:"/content/:model/edit/:id",component:Promise.all([n.e(3),n.e(7),n.e(2),n.e(4),n.e(6)]).then(n.bind(null,"Xjaj"))},{path:"/content/:model/detail/:id",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(14)]).then(n.bind(null,"HELq"))},{path:"/content/:pModel/detail/:pId/:ref/add",component:Promise.all([n.e(3),n.e(7),n.e(2),n.e(4),n.e(6)]).then(n.bind(null,"Xjaj"))},{path:"/content/:pModel/detail/:pId/:ref/edit/:id",component:Promise.all([n.e(3),n.e(7),n.e(2),n.e(4),n.e(6)]).then(n.bind(null,"Xjaj"))},{path:"/content/:model/detail/:id/:key",component:Promise.all([n.e(3),n.e(2),n.e(4),n.e(14)]).then(n.bind(null,"HELq"))},{path:"/content/view/:model/:view",component:Promise.all([n.e(3),n.e(17),n.e(2),n.e(4),n.e(13)]).then(n.bind(null,"zrVq"))},{path:"/config/admin",component:n.e(75).then(n.bind(null,"VJ2P"))},{path:"/iframe/:url",component:n.e(76).then(n.bind(null,"KgJh"))},{component:n.e(50).then(n.bind(null,"pGWQ"))}].map((function(e){return Object(Le["a"])(Object(Le["a"])({},e),{},{exact:!0})})),Ct=function e(t){var n=t.path,a=t.component,r=t.redirect,i=t.routes,c=t.exact,o=t.view,l=void 0===o?null:o;return{component:l?function(){return l}:Object(ot["d"])((function(){return a})),redirect:r,exact:c,path:n,routes:i&&i.map(e)}},St=[{path:"/user",component:n.e(53).then(n.bind(null,"Qs/n")),routes:[{path:"/user/login",component:n.e(46).then(n.bind(null,"iNMz"))},{path:"/user/register",component:n.e(52).then(n.bind(null,"uNUk"))},{path:"/user/qrcode_login",component:n.e(60).then(n.bind(null,"0+Vp"))},{path:"/user/install",component:n.e(9).then(n.bind(null,"z2hv"))}]},{path:"/login/qrcode_login",component:n.e(77).then(n.bind(null,"Bpwc"))},{path:"/",component:n.e(45).then(n.bind(null,"K3Pb")),routes:xt}].map(Ct),Ft=n("w4Tj"),At=n("oZsa"),Pt=n("0TMk"),Mt=function(){function e(t,n,a,r){Object(he["a"])(this,e),this.title=void 0,this.args=void 0,this.model=void 0,this.context=void 0,this.title=t,this.args=n,this.model=a,this.context=r}return Object(ve["a"])(e,[{key:"onTrigger",value:function(){}},{key:"render",value:function(){return this.context._renderer(this.onTrigger.bind(this),this.title)}},{key:"refresh",value:function(){var e,t;null===(e=(t=this.context).refresh)||void 0===e||e.call(t)}}]),e}(),Nt=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(){var e;Object(he["a"])(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),e.model=void 0,e}return Object(ve["a"])(n,[{key:"functionName",get:function(){return this.args.action}},{key:"params",get:function(){return this.args.params}},{key:"successMessage",get:function(){return"".concat(this.title,"\u6267\u884c\u6210\u529f")}},{key:"errorMessage",get:function(){return"".concat(this.title,"\u6267\u884c\u5931\u8d25")}},{key:"onTrigger",value:function(){var e=Object(ue["a"])(pe.a.mark((function e(){var t;return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=Date.now(),Be["default"].loading({content:"".concat(this.title,"\u6267\u884c\u4e2d"),key:t,duration:0}),e.prev=2,e.next=5,Object(we["cloudFunction"])({model:this.model,functionName:this.functionName,params:this.params});case 5:Be["default"].success({content:this.successMessage,key:t}),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](2),Be["default"].error({content:this.errorMessage,key:t}),console.error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,8]])})));function t(){return e.apply(this,arguments)}return t}()}]),n}(Mt),Dt=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(e,a,i,c){var o;Object(he["a"])(this,n),o=t.call(this,e,a,i,c),o.width="60%",o.visible=void 0,o.setVisible=void 0,o.close=void 0;var l=Object(r["useState"])(!1),s=Object(Oe["a"])(l,2);return o.visible=s[0],o.setVisible=s[1],o.close=function(){return o.setVisible(!1)},o}return Object(ve["a"])(n,[{key:"renderContent",value:function(){return null}},{key:"onTrigger",value:function(){this.setVisible(!0)}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,Object(Ft["a"])(Object(At["a"])(n.prototype),"render",this).call(this),i.a.createElement(Ge["a"],{title:this.title,width:this.width,destroyOnClose:!0,visible:this.visible,closable:!0,keyboard:!0,onOk:this.close,onCancel:this.close,footer:null},this.renderContent()))}}]),n}(Mt),Tt=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(){return Object(he["a"])(this,n),t.apply(this,arguments)}return Object(ve["a"])(n,[{key:"link",get:function(){return this.args.link}},{key:"onTrigger",value:function(){Object(ee["p"])(this.link)}}]),n}(Mt),It=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(){return Object(he["a"])(this,n),t.apply(this,arguments)}return Object(ve["a"])(n,[{key:"link",get:function(){return"/content/".concat(this.model,"/add")}}]),n}(Tt),Lt=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(){return Object(he["a"])(this,n),t.apply(this,arguments)}return Object(ve["a"])(n,[{key:"renderContent",value:function(){var e=this;return i.a.createElement(Pt["a"],Object(mt["a"])({model:this.model,onCreate:function(){e.close(),e.refresh()}},this.context.formProps))}}]),n}(Dt),qt=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(){return Object(he["a"])(this,n),t.apply(this,arguments)}return Object(ve["a"])(n,[{key:"render",value:function(){var e=Object(ce["U"])(this.model),t=e.modalForm,n=void 0===t||t,a=!1===n?It:Lt;return new a(this.title,this.args,this.model,this.context).render()}}]),n}(Mt);dt();var Bt=function(e){var t=e.context,n=void 0===t?Object(ce["g"])():t;return i.a.createElement(ce["b"].Provider,{value:n},i.a.createElement(c["a"],{prefixCls:"ant3",locale:s.a},i.a.createElement(o["a"],{locale:s.a},yt(St))))},Ut=function(e){Object(be["a"])(n,e);var t=Object(ge["a"])(n);function n(e,a,r,i){var c;return Object(he["a"])(this,n),c=t.call(this,e,a,r,i),c.model="meta__model",c.dispatch=void 0,c.dispatch=Object(ce["db"])(),c}return Object(ve["a"])(n,[{key:"functionName",get:function(){return"migrate"}},{key:"onTrigger",value:function(){var e=Object(ue["a"])(pe.a.mark((function e(){return pe.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(Ft["a"])(Object(At["a"])(n.prototype),"onTrigger",this).call(this);case 2:this.dispatch({type:"content/getConfig"}).then((function(){return Object(Fe["d"])("bsm_config__menu",Fe["b"].afterUpdate)}));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(Nt),Vt=Object(ce["g"])();Vt.tableAction("add",qt),Vt.tableAction("migrate",Ut);var Kt=Vt,Rt=i.a.createElement(Bt,{context:Kt});t["default"]=function(){return Rt}},fmT3:function(e,t,n){e.exports={descriptionList:"descriptionList___3sgFN",title:"title___jo_Je",term:"term___O9ehC",detail:"detail___2YYjY",small:"small___17xaW",large:"large___1SsxZ",vertical:"vertical___2V3oj"}},gOIk:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var a=n("k1fw"),r=(n("eNCU"),n("pjJH")),i=(n("vmZS"),n("NjVP")),c=n("tJVT"),o=n("q1tI"),l=n.n(o),s=n("/MKj"),u=n("EBSl"),d=n("3V3B"),m=n("0SIm"),p=n("jfUH"),f=n("0TMk"),h=Object(s["c"])()((function(e){var t=Object(o["useState"])(),n=Object(c["a"])(t,2),a=n[0],s=n[1],u=e.field,f=e.refresh,h=e.dispatch,v=e.model,b=e.mode,g=e.widget,y=e.selectedRowIds,j=void 0===y?[]:y,O=e.groupBy,E=Object(p["t"])(v,u);function k(){var e=window.g_app._store.getState(),t=e.content.schemas;if(a){var n={};n[E.refField]=j;var r={newValues:n,model:E.ref,id:Object(p["M"])(a,E.ref),schema:t[E.ref]};"append"===b&&(r.appendModeFields=[E.refField]),h({type:"content/patch",payload:r}).then(f)}}var w=d["a"];"Cascader"===g&&(w=m["a"]);var _={field:E,onChange:s,value:a,groupBy:O};return l.a.createElement(i["a"],{labelCol:{span:5},wrapperCol:{span:19}},l.a.createElement(i["a"].Item,{label:E.displayName},l.a.createElement(w,_)),l.a.createElement(i["a"].Item,{wrapperCol:{offset:5}},l.a.createElement(r["a"],{type:"primary",onClick:k},"\u63d0\u4ea4")))}));function v(){Object(u["q"])({type:u["b"],action:"delete",name:"\u5220\u9664",rspType:u["g"],confirm:!0,func:function(e,t,n,a){var r=window.g_app._store.dispatch,i=e.map((function(e){return Object(p["M"])(e,t)}));return r({type:"content/batchAction",payload:{model:t,ids:i,action:"delete"}}).then((function(){a.refresh()}))}}),Object(u["q"])({type:u["b"],action:"action",name:"\u4e91\u51fd\u6570",rspType:u["e"],confirm:!0,paramsDef:[{name:"action",displayName:"\u4e91\u51fd\u6570\u540d",require:!0,type:"string"},{name:"payload",displayName:"\u53c2\u6570",type:"text",isJson:!0,widget:"JsonEditor",help:"\u53c2\u6570\u683c\u5f0f\u4e3aJSON object"}]}),Object(u["q"])({type:u["b"],action:"nowEdit",name:"\u66f4\u65b0",rspType:u["g"],confirm:!0,paramsDef:[{name:"fields",displayName:"\u8bbe\u7f6e\u5c5e\u6027\u503c",require:!0,default:[],widget:"FieldsSet",params:function(t){var n=t.model;return{model:n,fieldFilter:e.negate(p["B"])}}}],func:function(e,t,n,r){var i=window.g_app._store.dispatch,c=e.map((function(e){return Object(p["M"])(e,t)})),o=Object(a["a"])(Object(a["a"])({},Object(u["m"])(u["b"],n.action)),{},{params:n.params});return i({type:"content/batchAction",payload:{model:t,ids:c,action:"nowEdit",payload:o.params}}).then((function(){r.refresh()}))}}),Object(u["q"])({type:u["b"],action:"batchRefAdd",name:"\u5173\u8054\u521b\u5efa",rspType:u["j"],component:function(e){var t=e.model,n=e.currentObject,a=e.currentActionParams,r=e.context.refresh,i=n.map((function(e){return Object(p["M"])(e,t)})),c=a.field,o=Object(p["t"])(t,c),s=null===o||void 0===o?void 0:o.ref,u={};return u[o.refField]=i,l.a.createElement(f["a"],{model:s,onCreate:function(){r()},hiddenvalues:u,hiddenFields:u})},title:function(e){var t=e.currentActionObject,n=e.model,a=e.currentActionParams,r=a.field,i=Object(p["t"])(n,r);return"".concat(t.name).concat(i.displayName)},paramsDef:[{name:"field",type:"string",require:!0,displayName:"\u5b57\u6bb5",filter:[],widget:"FieldPicker",params:function(e){var t=e.model;return{model:t,fieldFilter:p["D"]}}}]}),Object(u["q"])({type:u["b"],action:"batchRefConnect",name:"\u5efa\u7acb\u5173\u8054",rspType:u["j"],component:function(e){var t=e.model,n=e.currentObject,a=e.currentActionParams,r=e.context.refresh,i=n.map((function(e){return Object(p["M"])(e,t)})),c=a.field,o=a.mode,s=void 0===o?"append":o,u=a.widget,d=void 0===u?"Select":u,m=a.groupBy;return l.a.createElement(h,{field:c,selectedRowIds:i,mode:s,model:t,widget:d,refresh:r,groupBy:m})},title:function(e){var t=e.currentActionObject,n=e.model,a=e.currentActionParams,r=a.field,i=Object(p["t"])(n,r);return"".concat(t.name).concat(i.displayName)},paramsDef:[{name:"mode",displayName:"\u6a21\u5f0f",type:"string",default:"append",require:!1,choices:[["append","\u6dfb\u52a0"],["replace","\u8986\u76d6"]]},{name:"field",displayName:"\u5b57\u6bb5",type:"string",require:!0,widget:"FieldPicker",params:function(e){var t=e.model;return{model:t,fieldFilter:p["D"]}}},{name:"widget",displayName:"\u7ec4\u4ef6",type:"string",require:!1,choices:[["Select","\u4e0b\u62c9\u9009\u62e9\u5668"],["Cascader","\u7ea7\u8054\u9009\u62e9\u5668"]]},{name:"groupBy",displayName:"\u5206\u7ec4\u5b57\u6bb5",type:"string",widget:"FieldPicker",require:!0,show:'${widget} === "Cascader" && ${field}',params:function(e){var t,n=e.model,a=e.values,r=void 0===a?{}:a;if(r.field){var i=Object(p["t"])(n,r.field);t=i.ref}return{model:t,fieldFilter:p["D"]}}}]})}}).call(this,n("LvDl"))},leA8:function(e,t,n){"use strict";(function(e){n("SePM");var a,r,i,c,o,l,s=n("PMX6"),u=(n("smr7"),n("DlTu")),d=(n("eNCU"),n("pjJH")),m=n("0Owb"),p=(n("GPKB"),n("mFAc")),f=(n("52nx"),n("7bDm")),h=n("k1fw"),v=n("oBTY"),b=n("fWQN"),g=n("mtLc"),y=n("tS8v"),j=n("yKVA"),O=n("879j"),E=(n("t6ct"),n("BGsl")),k=(n("eE3J"),n("GSZB")),w=n("q1tI"),_=n.n(w),x=n("WHYC"),C=n("RLxJ"),S=n("/MKj"),F=n("jfUH"),A=n("txBY"),P=n("CD42"),M=n.n(P),N=n("0TMk"),D=function(e){var t=e.data,n=e.clickAdd,a=e.clickEdit,r=e.cilckDelete,i=e.actions;return _.a.createElement("div",{className:M.a.container},_.a.createElement("span",null,t.title),_.a.createElement("div",{className:M.a.content},"parent"in t&&i.includes("add")&&_.a.createElement("div",{className:M.a.content_box,onClick:function(e){n(t.key,e)}},_.a.createElement(k["a"],{type:"plus"})),i.includes("change")&&_.a.createElement("div",{className:M.a.content_box,onClick:function(e){a(t.key,e)}},_.a.createElement(k["a"],{type:"edit"})),t.children.length<=0&&i.includes("delete")&&_.a.createElement("div",{className:M.a.content_box,onClick:function(e){r(t.key,e)}},_.a.createElement(k["a"],{type:"delete"}))))},T=E["a"].TreeNode,I=(a=Object(S["c"])((function(e){var t=e.user.currentUser;return{currentUser:t}})),r=Reflect.metadata("design:type",Function),i=Reflect.metadata("design:paramtypes",[void 0]),Object(x["k"])(c=a(c=Object(A["a"])(c=r(c=i((l=o=function(t){Object(j["a"])(a,t);var n=Object(O["a"])(a);function a(t){var r;return Object(b["a"])(this,a),r=n.call(this,t),r.getNavList=function(){var t=r.props.cacheAll,n=r.state.expandedKeys,a=r.getProps,i=a.model,c=a.adminConfig;if(c[i]&&c[i].detail){var o=c[i].detail.showNav;o&&t({model:i}).then((function(t){var a=r.props.match.params.id,c=r.parentField,o=Object(v["a"])(n),l=e.keyBy(t,Object(F["N"])(i)),s=l[a];if(s){var u=s[c];while(u)o.push(u),u=l[u][c]}r.setState({expandedKeys:e.uniq(o)})}))}},r.handleSelect=function(e){var t=r.props.match.params.model;e.length&&C["a"].push("/content/".concat(t,"/detail/").concat(e[0]))},r.onExpand=function(e){r.setState({expandedKeys:e,autoExpandParent:!1})},r.calcTreeData=function(){var t=Object(y["a"])(r),n=t.navList,a=r.getProps,i=a.model,c=a.adminConfig,o=a.schemas,l=a.groupList,s=a.groupCount;if(e.isEmpty(c)||!n.length)return[];var u=Object(y["a"])(r),d=u.parentField,m=o[i].titleField,p=n.map((function(e){return Object(h["a"])(Object(h["a"])({},e),{},{title:e[m],key:e[Object(F["N"])(i)],children:[]})})),f=p.map((function(e){if(e[d]){var t=p.find((function(t){return e[d]===t.key}));t&&(t.children=t.children.concat(e))}return e}));if(l){var v=f.reduce((function(e,t,n){var a=Math.floor(n/s);return n%s!==0||0===n?e[a].children=(e[a].children||[]).concat(t):e[a]={title:"".concat(n+1,"-").concat(s*a+1),key:"group:".concat(n+1,"-").concat(s*a+1),children:[t]},e}),[{title:"1-".concat(s),key:"group:1-".concat(s),children:[]}]);return v}return f.filter((function(e){return!e[d]}))},r.clickAdd=function(e,t){e?(t.stopPropagation(),r.setState({showModal:!0,title:"\u6dfb\u52a0",objectPk:void 0,nowObject:{parent:e}})):r.setState({showModal:!0,title:"\u6dfb\u52a0",objectPk:void 0,nowObject:{}})},r.cilckDelete=function(e,t){var n=r.getProps,a=n.model,i=n.dispatch;t.stopPropagation(),f["a"].confirm({title:"\u786e\u5b9a\u5220\u9664\uff1f",onOk:function(){i({type:"content/delete",payload:{id:e,model:a}}).then((function(){p["a"].success("\u5220\u9664\u6210\u529f"),r.getNavList()}))}})},r.clickEdit=function(e,t){t.stopPropagation(),r.setState({showModal:!0,title:"\u7f16\u8f91",objectPk:e,nowObject:void 0})},r.handleOk=function(){r.setState({showModal:!1})},r.handleCancel=function(){r.setState({showModal:!1})},r.treeNodesChildren=function(e){return e?_.a.createElement(D,{data:e,clickAdd:r.clickAdd,clickEdit:r.clickEdit,cilckDelete:r.cilckDelete,actions:r.permissions}):null},r.renderTreeNodes=function(e){return e.map((function(e){return e.children?_.a.createElement(T,{title:r.treeNodesChildren(e),key:e.key},r.renderTreeNodes(e.children)):_.a.createElement(T,Object(m["a"])({key:e.key},e))}))},r.topadd=function(){return _.a.createElement("div",{onClick:function(){return r.clickAdd()}},_.a.createElement(d["a"],{icon:"plus",size:"small"},"\u6dfb\u52a0"))},r.state={expandedKeys:[],autoExpandParent:!0,showModal:!1,title:"",objectPk:"",nowObject:{parent:""}},r}return Object(g["a"])(a,[{key:"componentDidMount",value:function(){var t=this.getProps,n=t.schemas,a=t.adminConfig;e.isEmpty(n)||e.isEmpty(a)||this.getNavList()}},{key:"componentDidUpdate",value:function(t){var n=this.parentField,a=this.navList,r=this.state.expandedKeys,i=this.props.match.params.id,c=this.getProps.model,o=function(t){var n=t.schemas,a=t.adminConfig;return!e.isEmpty(n)&&!e.isEmpty(a)},l=o(t),s=o(this.getProps);if(!l&&s)this.getNavList();else if(i!==t.match.params.id){var u=Object(v["a"])(r),d=a.find((function(e){return Object(F["M"])(e,c)===i}));d&&function(){var e=d[n];while(e)u.push(e),e=a.find((function(t){return Object(F["M"])(t,c)===e}))[n]}(),this.setState({expandedKeys:e.uniq(u)}),window.scrollTo(0,0)}}},{key:"navList",get:function(){var e=this.props.all,t=this.getProps.model;return e[t]||[]}},{key:"parentField",get:function(){var e=this.getProps,t=e.model,n=e.adminConfig;return n[t].parentField||"parent"}},{key:"getProps",get:function(){var e=this.props,t=e.schemas,n=e.adminConfig,a=e.dispatch,r=e.match,i=r.params,c=i.model,o=i.id,l=r.path,s=r.url,u=e.groupList,d=e.groupCount;return{schemas:t,adminConfig:n,model:c,id:o,dispatch:a,url:s,path:l,groupList:u,groupCount:d}}},{key:"permissions",get:function(){var e=this.props.currentUser.permissions,t=void 0===e?[]:e,n=this.getProps.model;return t.filter((function(e){return e.endsWith(n)})).map((function(e){return e.split("_")[0]}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.autoExpandParent,a=t.expandedKeys,r=t.showModal,i=t.title,c=t.objectPk,o=t.nowObject,l=this.props.all,d=this.getProps.model,m=this.props.match.params.id,p=this.calcTreeData();if(!p.length&&!this.permissions.includes("add"))return null;var h=_.a.createElement(s["a"],{bordered:!1},this.permissions.includes("add")&&this.topadd(),d in l?_.a.createElement("div",{className:M.a.select},_.a.createElement(E["a"],{showLine:!0,onExpand:this.onExpand,expandedKeys:a,autoExpandParent:n,onSelect:this.handleSelect,selectedKeys:[m]},this.renderTreeNodes(p))):_.a.createElement(u["a"],null),_.a.createElement(f["a"],{title:i,width:"60%",destroyOnClose:!0,visible:r,closable:!0,keyboard:!0,onOk:this.handleOk,onCancel:this.handleCancel,footer:null},_.a.createElement(N["a"],{model:d,objectid:c,hiddenvalues:o,onCreate:function(){e.handleCancel(),e.getNavList()},onUpdate:function(){e.handleCancel(),e.getNavList()}})));return _.a.createElement("div",null,_.a.createElement("div",{style:{marginRight:24,overflowY:"auto",position:"sticky",top:0,maxHeight:"100vh"}},h))}}]),a}(w["Component"]),o.defaultProps={treeData:[]},c=l))||c)||c)||c)||c)||c);t["a"]=I}).call(this,n("LvDl"))},sC82:function(e,t,n){"use strict";var a=n("0Owb"),r=(n("e+1C"),n("Nd5c")),i=n("jrin"),c=n("PpiC"),o=n("q1tI"),l=n.n(o),s=n("TSYQ"),u=n.n(s),d=n("fmT3"),m=n.n(d),p=function(e){var t,n=e.className,o=e.title,s=e.col,d=void 0===s?3:s,p=e.layout,f=void 0===p?"horizontal":p,h=e.gutter,v=void 0===h?32:h,b=e.children,g=e.size,y=Object(c["a"])(e,["className","title","col","layout","gutter","children","size"]),j=u()(m.a.descriptionList,m.a[f],n,(t={},Object(i["a"])(t,m.a.small,"small"===g),Object(i["a"])(t,m.a.large,"large"===g),t)),O=d>4?4:d;return l.a.createElement("div",Object(a["a"])({className:j},y),o?l.a.createElement("div",{className:m.a.title},o):null,l.a.createElement(r["a"],{gutter:v},l.a.Children.map(b,(function(e){return e?l.a.cloneElement(e,{column:O}):e}))))},f=p,h=(n("ER8q"),n("Ai5L")),v={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{xs:24,sm:12,md:6}},b=function(e){var t=e.term,n=e.column,r=e.children,i=Object(c["a"])(e,["term","column","children"]);return l.a.createElement(h["a"],Object(a["a"])({},v[n],i),t&&l.a.createElement("div",{className:m.a.term},t),null!==r&&void 0!==r&&l.a.createElement("div",{className:m.a.detail},r))};b.defaultProps={term:""};var g=b;f.Description=g;t["a"]=f}},0,[3,2,4,22,35,27]]);