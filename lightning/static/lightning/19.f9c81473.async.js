(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{r7nV:function(e,t,a){"use strict";a.r(t);a("SePM");var r,n,l,i=a("PMX6"),c=(a("lNFX"),a("VE2L")),s=(a("4X2C"),a("xvon")),u=a("0Owb"),m=(a("e+1C"),a("Nd5c")),p=(a("ER8q"),a("Ai5L")),o=(a("eNCU"),a("pjJH")),d=(a("smr7"),a("DlTu")),f=a("k1fw"),b=a("tJVT"),h=a("9og8"),E=a("fWQN"),y=a("mtLc"),j=a("tS8v"),g=a("yKVA"),v=a("879j"),O=(a("5RCp"),a("a82I")),k=(a("vmZS"),a("NjVP")),_=(a("yavW"),a("WuMn")),x=(a("Ahcs"),a("k0dM")),V=a("WmNS"),w=a.n(V),q=a("q1tI"),C=a.n(q),S=a("LvDl"),D=a("WHYC"),R=a("RLxJ"),N=a("Hx5s"),F=a("/MKj"),P=a("NVqa"),A=a("9Ndd"),z=a("WiEq"),M=a("Nmjv"),T=a("hjOt"),L=a("v9ey"),I=a("jfUH"),U={labelCol:{xs:{span:24},sm:{span:4},lg:{span:3},xl:{span:3},xxl:{span:2}},wrapperCol:{xs:{span:24},sm:{span:20},md:{span:15},lg:{span:15},xl:{span:10},xxl:{span:7}}},W=A["b"].Select,J=A["b"].TextArea,K=A["b"].Switch,H=x["a"].TabPane,X=_["a"].Option,B=k["a"].Item,G=O["a"].Step,Z=(r=Object(F["c"])((function(e){var t=e.content,a=t.schemas,r=t.adminConfig,n=e.loading;return{schemas:a,adminConfig:r,loading:n.models.content}})),n=Object(I["d"])((function(){return{appModels:Object(I["lb"])()}})),Object(D["k"])(l=r(l=n(l=function(e){Object(g["a"])(a,e);var t=Object(v["a"])(a);function a(){var e;Object(E["a"])(this,a);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return e=t.call.apply(t,[this].concat(n)),e.state={operation:void 0,model:void 0,current:0,checkValues:!1},e.schemasData=function(){return new Promise((function(t){var a=[],r=0,n=function n(){r>10&&t("schemas\u6570\u636e\u9519\u8bef"),setTimeout((function(){var l=e.props.schemas;a=l,Object(S["isEmpty"])(a)?(r+=1,n()):t(a)}),500)};n()}))},e.handleSubmit=Object(h["a"])(w.a.mark((function t(){var a,r,n,l,i,c,s,u,m,p,o,d,f,h,E,y,g,v,O,k,_,x,V,q,C,S,D,N,F,P;return w.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.props.form,r=a.getFieldValue,n=a.getFieldsValue,l=a.validateFields,e.setState({checkValues:!0}),t.next=4,l();case 4:if(Object(M["f"])(r("parameter"))&&Object(M["g"])(r("setfield"))&&Object(M["d"])(r("filter"))){t.next=6;break}return t.abrupt("return");case 6:if(i=Object(j["a"])(e),c=i.operation,s=i.isUpdate,u=r("app__model"),c&&u){t.next=10;break}return t.abrupt("return");case 10:if(m=n(),p=m.app__model,o=m.parameter,d=m.ordering,f=m.displayfield,h=m.paging,E=m.page,y=m.size,g=m.pk,v=m.setfield,O=m.func_name,k=m.filter,_=Object(b["a"])(p,2),x=_[0],V=_[1],q={app:x,model:V},z["a"].default.forEach((function(e){q[e]=m[e]})),q.disable=!q.disable,q.operation=c,q.groups&&(q.groups=q.groups.map((function(e){return e.id}))),C=function(){var e={name:g,default:void 0,desc:"\u4e3b\u952e",required:!0,is_array:!1,type:"pk"};q.parameter.push(e)},"list"===c&&(q.parameter=Object(M["i"])(o),q.ordering=d,q.displayfield=f,h&&(S=y.name,D=y.default,N={name:E,default:1,desc:"\u9875\u7801\u53c2\u6570",required:!1,is_array:!1,type:"PAGE_IDX"},F={name:S,default:D,desc:"\u9875\u957f\u53c2\u6570",required:!1,is_array:!1,type:"PAGE_SIZE"},q.parameter.push(N),q.parameter.push(F)),q.filter=Object(M["h"])(k)),"retrieve"===c&&(q.displayfield=f,q.parameter=[],C()),"create"===c&&(q.parameter=Object(M["i"])(o),q.displayfield=f,q.setfield=Object(M["j"])(v)),"update"!==c&&"replace"!==c||(q.parameter=Object(M["i"])(o),C(),q.displayfield=f,q.setfield=Object(M["j"])(v)),"delete"===c&&(q.parameter=[],C()),"update_by_condition"===c&&(q.parameter=Object(M["i"])(o),q.setfield=Object(M["j"])(v),q.filter=Object(M["h"])(k)),"delete_by_condition"===c&&(q.parameter=Object(M["i"])(o),q.filter=Object(M["h"])(k)),"func"===c&&(q.parameter=Object(M["i"])(o),q.func_name=O),!s){t.next=33;break}return P=e.props.match.params.id,t.next=31,Object(L["a"])(q,parseInt(P,10));case 31:return R["a"].push("/content/api_db__api"),t.abrupt("return");case 33:return t.next=35,Object(L["a"])(q);case 35:R["a"].push("/content/api_db__api");case 36:case"end":return t.stop()}}),t)}))),e}return Object(y["a"])(a,[{key:"componentDidMount",value:function(){var e=this.props.match.params.id;(0===e||e)&&this.setDefaultValues(e)}},{key:"setDefaultValues",value:function(){var e=Object(h["a"])(w.a.mark((function e(t){var a,r,n,l,i,c,s,u,m,p,o,d,b,h,E;return w.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=this.props,r=a.form.setFieldsValue,n=a.dispatch,l=this.props.schemas,e.next=4,n({type:"content/detail",payload:{model:"api_db__api",id:t}});case 4:return i=e.sent,c=i.operation,s=i.slug,e.next=8,Object(L["b"])(s);case 8:if(u=e.sent,this.setState({operation:c,model:u.app__model}),!Object(S["isEmpty"])(l)){e.next=14;break}return e.next=13,this.schemasData();case 13:l=e.sent;case 14:return e.next=16,Object(M["c"])(u,l);case 16:m=e.sent,p=m.displayfield,o=m.filter,d=m.parameter,b=m.setfield,h=m.pk,E={displayfield:p,filter:o,parameter:d,setfield:b,pk:h},delete m.displayfield,delete m.filter,delete m.parameter,delete m.setfield,delete m.pk,r(Object(f["a"])({},m),(function(){setTimeout((function(){return r(E)}),2e3)}));case 25:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"operation",get:function(){var e=this.props.location.query.operation,t=this.isUpdate;return!e&&t?this.state.operation:e}},{key:"isUpdate",get:function(){var e=this.props,t=e.match.params.id,a=e.location.query.operation;return!(a||0!==t&&!t)}},{key:"model",get:function(){var e=this.props.form.getFieldValue,t=e("app__model"),a=this.state.model;if(Object(S["isEmpty"])(t))return a;var r="".concat(t[0],"__").concat(t[1]);return r}},{key:"schemas",value:function(){var e=this.props.schemas;return e.api_db__api||[]}},{key:"next",value:function(){var e=Object(h["a"])(w.a.mark((function e(){var t,a,r,n,l;return w.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.state.current,a=this.props.form,r=a.validateFields,n=a.getFieldValue,0!==t){e.next=5;break}return e.next=5,r(["func_name","slug","app__model","size","page","pk"]);case 5:if(1!==t){e.next=11;break}return this.setState({checkValues:!0}),e.next=9,r();case 9:if(Object(M["f"])(n("parameter"))&&Object(M["g"])(n("setfield"))&&Object(M["d"])(n("filter"))){e.next=11;break}return e.abrupt("return");case 11:l=t+1,this.setState({current:l});case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"prev",value:function(){var e=this.state.current,t=e-1;this.setState({current:t})}},{key:"render",value:function(){var e=this,t=this.props,a=t.form,r=a.getFieldDecorator,n=a.getFieldValue,l=a.resetFields,f=t.schemas,b=t.appModels,h=this.state,E=h.current,y=h.checkValues,j=this.operation,g=this.isUpdate;if(Object(S["isEmpty"])(f))return C.a.createElement(d["a"],null);var v=function(e){return j&&z["a"][j].includes(e)},V=this.model,w=function(){return Object(T["a"])({dollarData:n("parameter")})},q=C.a.createElement("div",null,C.a.createElement(m["a"],null,C.a.createElement(p["a"],{sm:{offset:2},xl:{offset:1}},C.a.createElement(o["a"],{size:"large",style:{marginRight:15},onClick:l},"\u53d6\u6d88"),C.a.createElement(o["a"],{size:"large",type:"primary",onClick:this.handleSubmit},"\u63d0\u4ea4")))),D=C.a.createElement("div",null,C.a.createElement(B,Object(u["a"])({label:"\u64cd\u4f5c"},U),r("operation",{initialValue:j})(C.a.createElement(W,{field:this.schemas().fields.find((function(e){return"operation"===e.name})),choices:this.schemas().fields.find((function(e){return"operation"===e.name})).choices,disabled:!0}))),v("func_name")&&C.a.createElement(B,Object(u["a"])({required:!0,label:"\u4e91\u51fd\u6570\u540d"},U),r("func_name",{rules:[{message:"\u8bf7\u8f93\u5165\u4e91\u51fd\u6570\u540d",required:!0}]})(C.a.createElement(s["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),C.a.createElement(B,Object(u["a"])({label:"\u540d\u79f0"},U),r("name",{})(C.a.createElement(s["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),C.a.createElement(B,Object(u["a"])({required:!0,label:"\u8def\u5f84"},U),r("slug",{rules:[{message:"\u8bf7\u8f93\u5165\u8def\u5f84",required:!0}]})(C.a.createElement(s["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),C.a.createElement(B,Object(u["a"])({required:!0,label:"\u6a21\u578b"},U),r("app__model",{rules:[{message:"\u8bf7\u9009\u62e9\u6a21\u578b",required:!0}]})(C.a.createElement(c["a"],{options:b,placeholder:"\u8bf7\u9009\u62e9",displayRender:function(e){return e.join("__")}}))),v("paging")&&C.a.createElement(B,Object(u["a"])({label:"\u5206\u9875"},U),r("paging",{initialValue:!1})(C.a.createElement(K,null))),n("paging")&&v("size")&&C.a.createElement("div",null,C.a.createElement(B,Object(u["a"])({required:!0,label:"\u9875\u957f\u53c2\u6570"},U),r("size",{initialValue:{name:"pageSize",default:30},rules:[{validator:M["e"]}]})(C.a.createElement(P["b"],null))),C.a.createElement(B,Object(u["a"])({required:!0,label:"\u9875\u7801\u53c2\u6570"},U),r("page",{initialValue:"pageNumber",rules:[{message:"\u8bf7\u8f93\u5165\u9875\u7801\u53c2\u6570",required:!0}]})(C.a.createElement(s["a"],null)))),v("pk")&&C.a.createElement(B,Object(u["a"])({required:!0,label:"\u4e3b\u952e"},U),r("pk",{initialValue:"id",rules:[{message:"\u8bf7\u8f93\u5165\u4e3b\u952e",required:!0}]})(C.a.createElement(s["a"],null))),C.a.createElement(B,Object(u["a"])({label:"\u8bf4\u660e"},U,{wrapperCol:{xs:{span:24},sm:{span:20},xxl:{span:15}}}),r("summary",{})(C.a.createElement(J,{placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8",field:this.schemas().fields.find((function(e){return"summary"===e.name}))}))),C.a.createElement(B,Object(u["a"])({label:"\u542f\u7528"},U),r("disable",{initialValue:!1})(C.a.createElement(K,null)))),R=C.a.createElement("div",null,v("parameter")&&V&&C.a.createElement(B,null,r("parameter",{initialValue:{}})(C.a.createElement(P["c"],{schemas:f,model:V,operation:j,isNew:!g}))),v("setfield")&&V&&C.a.createElement(B,null,r("setfield",{initialValue:{}})(C.a.createElement(P["e"],{schemas:f,model:V,operation:j,getParameterValue:function(){return n("parameter")},isNew:!g,systemData:z["b"]}))),v("displayfield")&&V&&C.a.createElement(B,null,r("displayfield",{initialValue:[]})(C.a.createElement(P["a"],{schemas:f,model:V}))),v("filter")&&V&&C.a.createElement("div",null,C.a.createElement("div",{style:{paddingBottom:2}},C.a.createElement("span",{style:{fontSize:26}},"\u8fc7\u6ee4\u89c4\u5219")),C.a.createElement(B,null,r("filter",{initialValue:[]})(C.a.createElement(P["d"],{columns:Object(M["k"])(f,V),getVariableData:w,systemData:z["b"]})))),v("ordering")&&C.a.createElement(B,Object(u["a"])({label:"\u6392\u5e8f"},U,{labelCol:{xs:{span:24},sm:{span:2},xl:{span:1}}}),r("ordering",{})(C.a.createElement(_["a"],{placeholder:"\u8bf7\u9009\u62e9",mode:"multiple",allowClear:!0},Object(M["l"])(f,V).map((function(e){return C.a.createElement(X,{key:e.key,value:e.key},e.label)})))))),N=C.a.createElement("div",null,C.a.createElement(B,Object(u["a"])({label:"\u8981\u6c42\u767b\u5f55"},U),r("logined",{initialValue:!1})(C.a.createElement(K,null))),C.a.createElement(B,Object(u["a"])({label:"\u89d2\u8272"},U),r("groups",{})(C.a.createElement(W,{field:this.schemas().fields.find((function(e){return"groups"===e.name}))})))),F=function(){return C.a.createElement(O["a"],{current:E,style:{marginBottom:30}},C.a.createElement(G,{key:0,title:"\u57fa\u672c\u4fe1\u606f"}),C.a.createElement(G,{key:1,title:"\u64cd\u4f5c\u914d\u7f6e"}),C.a.createElement(G,{key:2,title:"\u6743\u9650\u914d\u7f6e"}))},A=C.a.createElement("div",null,C.a.createElement(k["a"],null,C.a.createElement(i["a"],null,g?C.a.createElement("div",null,C.a.createElement(x["a"],{defaultActiveKey:"1"},C.a.createElement(H,{tab:"\u57fa\u672c\u4fe1\u606f",key:"1",forceRender:!0},D),C.a.createElement(H,{tab:"\u64cd\u4f5c\u914d\u7f6e",key:"2",forceRender:!0},R),C.a.createElement(H,{tab:"\u6743\u9650\u914d\u7f6e",key:"3",forceRender:!0},N)),q):C.a.createElement("div",null,C.a.createElement("div",{style:{marginTop:30}},C.a.createElement(x["a"],{defaultActiveKey:"0",renderTabBar:F,activeKey:"".concat(E)},C.a.createElement(H,{key:"0",forceRender:!0},D),C.a.createElement(H,{key:"1",forceRender:!0},R),C.a.createElement(H,{key:"2",forceRender:!0},N))),C.a.createElement(m["a"],null,C.a.createElement(p["a"],{sm:{offset:2},xl:{offset:1}},E<2&&C.a.createElement(o["a"],{type:"primary",onClick:function(){return e.next()}},"\u4e0b\u4e00\u6b65"),E>0&&C.a.createElement(o["a"],{style:{marginLeft:8,marginRight:8},onClick:function(){return e.prev()}},"\u4e0a\u4e00\u6b65"),2===E&&C.a.createElement(o["a"],{style:{marginLeft:8,marginRight:8},onClick:l},"\u53d6\u6d88"),2===E&&C.a.createElement(o["a"],{type:"primary",onClick:this.handleSubmit},"\u63d0\u4ea4")))))));return C.a.createElement(M["a"].Provider,{value:y},A)}}]),a}(q["PureComponent"]))||l)||l)||l),Q=k["a"].create()(Z);t["default"]=function(e){return C.a.createElement(N["a"],null,C.a.createElement(Q,e))}}}]);